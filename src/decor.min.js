// DecorJS - v0.42 | https://github.com/Q42/DecorJS | (c) 2014 Q42, Marcel Duin <marcel@q42.nl> | MIT Licensed, https://github.com/Q42/DecorJS/blob/master/LICENSE
if(!window.$){$=function(a){return new _$(a)};$.extend=function(){function a(c,d){for(var f in c){var h=c[f],l=h&&h.constructor;d[f]=b&&l&&(l==Array||l==Object)?a(h,new l):!l||l!=Number&&l!=String?h:e&&l==String&&d[f]&&d[f].constructor==String?d[f]+" "+h:l(h)}return d}for(var c=arguments,b=!0===c[0],d=c[b&&1||0],e=c[b&&3||2],h=b?2:1;h<c.length;h++)a(c[h],d);return d};var _getEls=function(a,c){if(a==window)return[window];if(a instanceof Element)return[a];if(a instanceof Array||a instanceof _$)return a;
if(/^\</.test(a)){var b=document.createElement("div");b.innerHTML=a;return b.childNodes}return a?(c||document).querySelectorAll(a):[]},_$=function(a,c){var b=_getEls(a,c),d;for(d in b)this[d]=b[d];this.length||(this.length=b.length)};_$.prototype={each:function(a){for(var c=0;c<this.length;c++)a.call(this[c]);return this},remove:function(){this.each(function(){this.parentNode.removeChild(this)});return this},replaceWith:function(a){var c=this;c[0]&&(a.each?a.each(function(){c[0].parentNode.insertBefore(this,
c[0])}):c[0].parentNode.insertBefore(a,c[0]),c.remove());return this},appendTo:function(a){a=a.length?a[0]:a;this.each(function(){a.appendChild(this)});return this},parent:function(){var a=[];this.each(function(){0>a.indexOf(this.parentNode)&&a.push(this.parentNode)});return new _$(a)},children:function(a){a=a||"*";var c=[];this.each(function(){for(var b=this.querySelectorAll(a),d=0;d<b.length;d++)b[d].parentNode==this&&c.push(b[d])});return new _$(c)},find:function(a){return new _$(a,this[0])},filter:function(a,
c){a=_getEls(a);return new _$([].filter.call(this,function(b){for(var d=0;d<a.length;d++)if(a[d]==b)return!c;return!!c}))},not:function(a){return this.filter(a,!0)},eq:function(a){return new _$(this[a])},has:function(a){for(var c=0;c<this.length;c++)if(this[c]==a)return!0},add:function(a){a=_getEls(a);for(var c=[],b=0;b<this.length;b++)c.push(this[b]);a=c.concat([].filter.call(a,function(a){return-1==c.indexOf(a)}));return a.length==this.length?this:new _$(a)},attr:function(a,c){if(void 0===c)return this[0]&&
this[0].getAttribute(a);this.each(function(){this[(null===c?"remove":"set")+"Attribute"](a,c)});return this},trigger:function(a,c){this.each(function(){var b=!isIE&&window.CustomEvent?new CustomEvent(a,{detail:c}):document.createEvent("CustomEvent");isIE&&b.initCustomEvent(a,!1,!1,c);this.dispatchEvent(b)});return this},on:function(a,c){a=a.split(" ");this.each(function(){for(var b in a)this.addEventListener(a[b],c)});return this},off:function(a,c){a=a.split(" ");this.each(function(){for(var b in a)this.removeEventListener(a[b],
c)});return this},click:function(a){if(a instanceof Function)this.on("click",a);else this.trigger("click");return this},text:function(a){if(void 0===a)return this[0]&&this[0].textContent;this.each(function(){this.textContent=a});return this},html:function(a){if(void 0===a)return this[0]&&this[0].innerHTML;this.each(function(){this.innerHTML=a});return this},hasClass:function(a,c){c=0;this.each(function(){c+=this.classList.contains(a)&&1||0});return!!c},addClass:function(a){a=a.split(" ");this.each(function(){for(var c in a)a[c]&&
this.classList.add(a[c])});return this},removeClass:function(a){a=a.split(" ");this.each(function(){for(var c in a)a[c]&&this.classList.remove(a[c])});return this},toggleClass:function(a){a=a.split(" ");for(var c in a)if(a[c])this[(this.hasClass(a[c])?"remove":"add")+"Class"](a[c]);return this},setcss:function(a,c){this.each(function(){this.style.setProperty(a,c)});return this},getcss:function(a){return this[0]&&this[0].style.getPropertyValue(a)},css:function(a,c){if("string"==typeof a){if(void 0===
c)return this.getcss(a);this.setcss(a,c)}else for(var b in a)this.setcss(b,a[b]);return this},hide:function(){this.setcss("display","none");return this},show:function(){this.setcss("display","block");return this},width:function(){return this[0]&&this[0].clientWidth},height:function(){return this[0]&&this[0].clientHeight}}}
$.browser||($.browser=new function(){var a=navigator.userAgent.toLowerCase();this.webkit=/applewebkit/.test(a);this.firefox=/firefox/.test(a);this.safari=/safari/.test(a)&&!/chrome/.test(a);this.ie=/msie/.test(a)||/trident/.test(a);this.iOS=/ipad|iphone|ipod/.test(a);this.android=/android/.test(a);this.mobile=this.iOS||this.android;this.unknown=!this.webkit&&!this.firefox&&!this.ie&&!this.iOS&&!this.android;a=this.webkit?a.match(/applewebkit\/(\d+)\./)[1]:this.firefox?a.match(/firefox\/(\d+)\./)[1]:
this.ie?a.match(/(msie\s|rv\:)(\d+)\./)[2]:-1;this.version=parseFloat(a)});
Decor=new function(){var a=this;isWebkit=$.browser.webkit;isFirefox=$.browser.firefox;isSafari=$.browser.safari;isIE=$.browser.ie;isIOS=$.browser.iOS;isAndroid=$.browser.android;isMobile=$.browser.mobile;var c=document.documentElement.classList;isWebkit&&c.add("webkit");isFirefox&&c.add("firefox");isIE&&c.add("ie");isIOS&&c.add("ios");isAndroid&&c.add("android");isMobile&&c.add("mobile");this.compatible=isWebkit&&530<=$.browser.version||isFirefox&&21<=$.browser.version||isIE&&10<=$.browser.version||
isMobile;c3p=isWebkit||isIOS?"-webkit-":"";c3={transform:c3p+"transform",transition:c3p+"transition",transitionD:c3p+"transition-duration",transitionTF:c3p+"transition-timing-function",animation:c3p+"animation"};c3d={transform:(isWebkit||isIOS?"webkitT":"t")+"ransform",transition:(isWebkit||isIOS?"webkitT":"t")+"ransition",animation:(isWebkit||isIOS?"webkitA":"a")+"animation"};$window=$(window);var b={};this.Scenes={};this.Things={};this.reloadScene=function(){a.resetTo(Decor.currentScene.name)()};
this.reset=function(){var b=null,c;for(c in Decor.Scenes){b=c;break}a.resetTo(b)()};this.resetTo=function(c){return function(){Decor.currentScene&&Decor.currentScene.hide(function(){localStorage.removeItem("currentScene");Decor.currentScene=null;for(var e in b)a.delete(e);a.goto(c)()})}};this.resetHard=function(){localStorage.removeItem("currentScene");Decor.currentScene?Decor.currentScene.hide(function(){location.reload()}):location.reload()};this.goto=function(a){return function(c){function h(){(b[a]||
(b[a]=new Decor.Scene(a,k))).show()}var g=Decor.currentScene;if(!g||g.name!=a){c&&c.target&&(c.stopPropagation(),c.preventDefault());var k=Decor.Scenes[a];if(!k)return console.error("Scene ["+a+"] not found");g?g.hide(h):h()}}};this.delete=function(a){function c(){delete b[a]}b[a]&&(b[a].deleted?c():b[a].delete(c))}};
Decor.Scene=function(a,c){function b(a){a=a||{};a.dims=a.dims||[1,1];a.pos=a.pos||[0,0,0];a.rot=a.rot||[0,0,0];return a}function d(){if(!r){$(document.body).removeClass("done-loading");r=!0;f.$[0].scrollLeft=0;h();c.objects.sort(function(a,b){return(a.o&&a.o.pos&&a.o.pos[2]||0)-(b.o&&b.o.pos&&b.o.pos[2]||0)});for(var a=0;a<c.objects.length;a++){var d=c.objects[a];d.o=d.o||{};if(!d.o.noIE||!isIE){var l,g,m;for(m in d){l=m;g=d[m];break}c.prototypes&&/^\$/.test(g)&&(g=g.substr(1),d.o=$.extend(d.o,c.prototypes[g],
!0),g=g.toLowerCase());d.o.img&&p++;var k=Decor.Things[l];k?(d=new k(f,g,b(d.o)),d.name=g,f.objects.push(d)):console.error("Object type "+l+" not found")}}if(c.oninit)c.oninit(f);p||e();n=p}}function e(){c.scrollLeft&&f.camera.setPosition([10*(c.scrollLeft||0),0,0]);f.$.addClass("loaded");f.show()}function h(){clearTimeout(t);t=setTimeout(g,20);f.$.addClass("resizing");s||(s=f.$[0].scrollLeft/f.$[0].scrollWidth);var a=[innerWidth,innerWidth/m];a[1]>innerHeight&&(a=[innerHeight*m,innerHeight]);var b=
{"margin-left":(f.margin[0]=c.fullWidth?0:Math.round((innerWidth-a[0])/2))+"px","margin-top":(f.margin[1]=Math.round((innerHeight-a[1])/2))+"px"};c.fixedSize&&c.res?f.$.css(c3.transform,"scale("+(f.scale=a[0]/l[0])+")"):(f.width=Math.round(a[0]),b.width=(c.fullWidth?innerWidth:f.width)+"px",b.height=(f.height=Math.round(a[1]))+"px");f.$.css(b).trigger("scene-resize")}function g(){f.$.removeClass("resizing");s&&(f.$[0].scrollLeft=f.camera.position[2]?0:Math.round(s*f.$[0].scrollWidth));s=0}function k(a){for(var b in f.objects)f.objects[b].destroy&&
f.objects[b].destroy();f.$.remove();delete f.$;f.deleted=!0;a&&a()}c=$.extend(!0,{},c);var f=this,m=c.aspectRatio||16/9,l=c.res||[innerWidth,innerHeight*m],q=!1,r=!1,p=0,n=0,s=0,t=null;c.width=c.width||1;c.height=c.height||1;this.name=a;this.data=c;this.width=l[0];this.height=l[1];this.scale=1;this.objects=[];this.collisionObjects=[];this.margin=[0,0];this.camera=new Decor.Camera(this);this.deleted=this.active=!1;this.$=$("<scene>").addClass(a).css({width:l[0]+"px",height:l[1]+"px"}).appendTo(document.body);
c.scrolling&&(1<c.width&&$('<div class="canvas">').css("width",100*c.width+"%").appendTo(this.$),1<c.height&&$('<div class="canvas vert">').css("height",100*c.height+"%").appendTo(this.$));this.imageLoaded=function(){--p||e();if(n){var a=20*Math.round(5*((n-p)/n));$(document.body).addClass("loaded-"+a)}};this.addLoadImage=function(){p++;n++};this.getThing=function(a){for(var b in f.objects)if(f.objects[b].name==a)return f.objects[b]};this.show=function(){if(!q){if(r)h();else return d();Decor.currentScene&&
Decor.delete(Decor.currentScene.name);Decor.currentScene=this;localStorage.setItem("currentScene",a);f.$.addClass("placed");q=!0;f.active=!0;addEventListener("resize",h);c.audio&&Decor.Audio.play(c.audio.src,c.audio);f.$.trigger("scene-show",a);onbeforeunload=function(){f.delete()};setTimeout(function(){f.$.addClass("shown");$(document.body).addClass("done-loading scene-shown").removeClass("loaded-"+[0,20,40,60,80,100].join(" loaded-"));if(c.onshow)c.onshow(f)})}};this.hide=function(b,d){if(!q)return b&&
b();q=!1;f.active=!1;f.$.removeClass("shown");$(document.body).removeClass("scene-shown");$window.add(f.$).trigger("scene-hide",a);removeEventListener("resize",h);c.audio&&Decor.Audio.stop(c.audio.src);setTimeout(function(){f.$.removeClass("placed");b&&b()},c.hideDuration||0)};this.delete=function(a){q?f.hide(function(){k(a)}):k(a)}};
Decor.Camera=function(a){function c(b){if(!(!b instanceof Function))for(var c in a.objects){var d=a.objects[c];d.matrix&&(d.attr.main||b.call(d))}}function b(){var a={};a[c3.transitionTF]="";a[c3.transitionD]="";c(function(){this.$cnt.css(a)})}var d=this,e=a.data.height-1,h=a.data.limitCamera,g=a.data.cameraPosition,k="0,0,0";this.offset=[0,e,0];this.position=[0,0,0];this.panTo=function(a,e,h,g){if(a instanceof Array){clearTimeout(null);var k={};k[c3.transitionTF]=h||"ease-in-out";k[c3.transitionD]=
(e||0)/1E3+"s";c(function(){this.$cnt.css(k)});d.setPosition(a,g);setTimeout(b,e+50)}};this.setPosition=function(b,g){var l=b+"";k!=l&&(k=l,d.position[0]=h?Math.min(a.data.width,Math.max(-1,b[0])):b[0],d.position[1]=h?Math.min(e,Math.max(0,b[1])):b[1],d.position[2]=b[2],c(function(){this.place(g)}))};this.reset=function(a){d.panTo([0,0,0],a,null,!0)};this.resetZ=function(a){d.panTo([d.position[0],d.position[1],0],a,null,!0)};g&&setTimeout(function(){2==g.length&&g.push(0);d.setPosition(g)})};
Decor.Object3D=function(a,c,b){var d=this;this.matrix=new Decor.Mat3D(this,b.pos,b.rot,b.scale);this.notInView=!1;this.reset=function(){d.matrix.translate(null,!0);return d};this.setPosition=function(a){b.pos[0]=a[0];b.pos[1]=-a[1];b.pos[2]=a[2];d.reset().place()};this.translate=function(a,b){d.matrix.translate(a);d.place();return d};this.setNotInView=function(a){d.notInView!=a&&((d.notInView=a)?c.hide():c.show())};this.place=function(a){c[0].style[c3d.transform]=d.matrix.getCSS(a)};this.focus=function(e){var h=
"zoom-out";if(c.toggleClass("open").hasClass("open")){h="zoom-in";a.$.find(".open").not(c).removeClass("open");var g=d.matrix.getPosition(),k=d.$.width(),f=d.$.height();f>a.height?g[2]-=a.height-1.05*f:k>a.width&&(g[2]-=(a.width-k)/2);g[0]-=(1-(b.width||0))/2;g[1]*=-1;g[2]*=-1;e instanceof Array&&(g[0]+=e[0],g[1]+=e[1],e[2]&&(g[2]+=e[2]));a.currentFocus=d;a.camera.panTo(g,a.data.focusDuration||0)}else a.currentFocus=null,a.camera.reset(a.data.focusDuration||0);a.$.trigger(h,d.name)};this.place();
a.$.on("scene-resize",d.place)};
Decor.Mat3D=function(a,c,b,d){c=c||[0,0,0];b=b||[0,0,0];d=d?d.length?d:[d||1,d||1,1]:[1,1,1];2==d.length&&d.push(1);var e=this,h=a.scene,g=h.camera.position,k=[0,0,0],f=[a.rwidth,a.rheight];this.getQuad=function(a){a=a||[0,0,0];var b=e.getPosition();return{l:b[0]+a[0],r:b[0]+a[0]+f[0],t:-(b[1]-a[1]),b:-(b[1]-a[1]-f[1])}};this.intersects=function(a){var b=e.getQuad();return!(a.l>b.r||a.r<b.l||a.t>b.b||a.b<b.t)};this.getCSS=function(e){var f=a.scene.camera.offset,q=a.attr.relative?0:g[0],r=a.attr.relative?
0:f[1]-(h.data.height-1)-g[1],p=[h.width,h.height],n=[];e||(q-=h.$[0].scrollLeft/h.width);e=[Math.round(p[0]*(c[0]+k[0]+f[0]-q)),-Math.round(p[1]*(c[1]+k[1]+r)),0.3*(c[2]+k[2]+g[2])+f[2]];n.push("translate3d("+e.join("px,")+"px)");b[0]&&n.push("rotateX("+b[0]+"deg)");b[1]&&n.push("rotateY("+b[1]+"deg)");b[2]&&n.push("rotateZ("+b[2]+"deg)");1==d[0]&&1==d[1]&&1==d[2]||n.push("scale3d("+d.join(",")+")");return n.join(" ")};this.getPosition=function(a){return[c[0]+k[0],-(c[1]+k[1]),c[2]+k[2]]};this.getElementPosition=
function(){var b=e.getPosition(),c=getComputedStyle(a.$[0])[c3.transform];/^matrix\(/.test(c)&&(c=c.substr(0,c.length-1).split(","),b[0]+=parseFloat(c[4])/h.width,b[1]+=parseFloat(c[5])/h.height);return b};this.getX=function(){return c[0]+k[0]};this.getY=function(){return c[1]+k[1]};this.getZ=function(){return c[2]+k[2]+g[2]};this.translate=function(a,b){b&&(k=[0,0,0]);a&&(k[0]+=a[0],k[1]+=a[1],k[2]+=a[2]);return e}};
Decor.Frame=new function(){function a(e){if(c.length){for(var h=c.length;h--;)c.shift()(e);d=requestAnimationFrame(a)}else b&&(b=!1,cancelAnimationFrame(d))}var c=[],b=!1,d=null;this.request=function(e){1==c.push(e)&&(b||(b=!0,d=requestAnimationFrame(a)))};this.cancel=function(a){for(var h=0;h<c.length;h++)a==c[h]&&c.shift();!c.length&&b&&(b=!1,cancelAnimationFrame(d))}};
Decor.Audio=new function(){function a(a,b){b=b||{};this.audio=new Audio;this.audio.volume=b.volume||1;this.audio.src=this.src=a;this.play()}function c(a){(isIE||isIOS||isSafari)&&/\.ogg$/.test(a)&&(a=a.replace(/\.ogg/,".mp3"));return a}var b=[];a.prototype={playing:!1,play:function(){this.audio&&!this.playing&&(this.playing=!0,this.audio.load(),this.audio.play(),this.audio.addEventListener("ended",this.stop))},stop:function(){this.playing&&(this.playing=!1,this.audio.pause())}};this.play=function(d,
e){d=c(d);var h;a:{for(h in b)if(b[h].src==d&&!b[h].playing){h=b[h];break a}h=void 0}h?h.play.call(h):b.push(h=new a(d,e));return h.audio};this.stop=function(a){a=c(a);for(var e in b)b[e].src==a&&b[e].stop.call(b[e])}};
Decor.Things.Thing=function(a,c,b){var d=this;this.attr=b;this.scene=a;var e=$(b.static?"<thing>":'<dud class="dud">');this.$cnt=e;this.$=b.static?e:$("<thing>").appendTo(e);this.$[0].thing=e[0].thing=this;b.static&&e.addClass("static");this.$.addClass(c+(b.class?" "+b.class:""));this.$cnt.addClass(c+"-cnt");b.clickable&&e.addClass("clickable");b.textContent&&this.$.text(b.textContent);this.setDims=function(){var c=b.isDepth?a.height/1080:1;d.$.css({width:(d.width=b.px&&b.px[0]||Math.round(b.dims[0]*
a.width))+"px",height:d.height=b.px&&b.px[1]||Math.round(b.dims[1]/c*a.height)+"px"});d.rwidth=b.px?b.px[0]/a.width:b.dims[0];d.rheight=b.px?b.px[1]/a.height:b.dims[1]};this.show=function(){e.appendTo(a.$)};this.hide=function(){e.remove()};this.destroy=function(){e.remove()};Decor.Object3D.call(this,a,e,b);a.$.on("scene-resize",this.setDims);this.setDims();b.noshow||this.show()};Decor.Things.Static=function(a,c,b){b.static=!0;Decor.Things.Thing.call(this,a,c,b)};
Decor.Things.HTMLContain=function(a,c,b){function d(){e.$cnt.css("font-size",b.relativeFontSize*a.height+"px")}var e=this;Decor.Things.Static.call(this,a,c,b);$(b.selector).appendTo(this.$cnt);b.watch&&(e.$cnt.addClass("hidden"),a.$.on("zoom-in zoom-out",function(a){"zoom-in"==a.type&&a.detail==b.watch?e.$cnt.removeClass("hidden"):e.$cnt.addClass("hidden")}));if(b.relativeFontSize)a.$.on("scene-show scene-resize",d)};
Decor.Things.ImageContain=function(a,c,b){function d(){var a=k.offsetHeight*g.width()/k.offsetWidth,b=Math.round(a*l[0][1]);f.css({height:a-b,bottom:b})}b.width&&(b.dims=[b.width,0]);var e=this,h=b.px?b.px[0]+"px":100*b.dims[0]+"%",g=$("<"+(b.tagName||"dud")+' class="dud">').css("width",h).appendTo(a.$);this.attr=b;this.scene=a;var k=null,k=new Image;k.thing=e;k.onload=function(l){b.dims[1]=b.dims[0]*k.height/k.width;e.rwidth=b.dims[0];e.rheight=b.dims[1];m&&d();e.$.addClass("image "+c);b.static&&
(e.$.css("width",h),e.$cnt.replaceWith(e.$),e.$cnt=g=e.$);g.addClass(c+"-cnt");b.class&&g.addClass(b.class);Decor.Object3D.call(e,a,g,b);b.clickable&&b.clickToFocus&&(m?f:e.$).click(e.focus);b.static||e.$.appendTo(e.$cnt);if(e.onload)e.onload();a.imageLoaded(c)};k.onerror=a.imageLoaded;k.src=b.img;e.$=$(k);e.$cnt=g;g[0].thing=this;var f=$(),m=b.clickable&&b.clickable.length;isIE&&11>$.browser.version&&(m=!1);var l=b.clickable&&b.clickable.length?b.clickable:[[0,0],[1,1]];b.clickable&&(g.addClass("clickable"),
m&&(g.addClass("has-area"),f=$('<div class="click">').css({left:100*l[0][0]+"%",width:100*(l[1][0]-l[0][0])+"%"}).appendTo(g)));if(m)a.$.on("scene-resize",d);this.destroy=function(){g.remove()}};Decor.Things.Image=function(a,c,b){b.static=!0;Decor.Things.ImageContain.call(this,a,c,b)};Decor.Things.ImageLink=function(a,c,b){b.tagName="a";Decor.Things.ImageContain.call(this,a,c,b);this.$cnt[0].href=b.href;b.external&&(this.$cnt[0].target="_blank");b.title&&(this.$cnt[0].title=b.title)};
Decor.Things.ImageBG=function(a,c,b){var d=this;b.class="imagebg "+(b.class||"");Decor.Things.Static.call(this,a,c,b);if(b.width){b.dims[0]=b.width;b.dims[1]=0;var e=new Image;e.onload=function(){b.dims[1]=b.dims[0]*e.height/e.width/(a.height/a.width);d.setDims();a.imageLoaded()};e.src=b.img}else a.imageLoaded();this.$.css("background-image","url("+b.img+")")};
Decor.Things.ImageRep=function(a,c,b){a.imageLoaded();for(var d=0;d<b.repeat;d++)a.addLoadImage(),a.objects.push(new Decor.Things.Image(a,c,{img:b.img,width:b.width,pos:[b.pos[0]+d*b.width,b.pos[1],b.pos[2]]}))};Decor.Things.ThingRep=function(a,c,b){for(var d=0;d<b.repeat;d++)a.objects.push(new Decor.Things.Thing(a,c,{dims:b.dims,px:b.px,pos:[b.pos[0]+d*b.trans[0],b.pos[1]+d*b.trans[1],b.pos[2]-d*b.trans[2]]}))};
Decor.Things.Overlay=function(a,c,b){var d=this,e=$(b.selector);this.$cnt=$('<div class="overlay '+c+(b.class?" "+b.class:"")+'">').appendTo(document.body);this.$=(e[0]?e:$("<div>")).appendTo(this.$cnt);this.destroy=function(){d.$cnt.remove()};a.$.on("scene-show scene-resize",function(){d.$cnt.css({width:b.px?b.px[0]:Math.round(a.width*b.dims[0])+"px",height:b.px?b.px[1]:Math.round(a.height*b.dims[1])+"px",left:a.$[0].offsetLeft+Math.round(a.width*b.pos[0])+"px",top:a.$[0].offsetTop+Math.round(a.height*
b.pos[1])+"px"})})};
