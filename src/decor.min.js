// DecorJS - v0.5 | https://github.com/Q42/DecorJS | (c) 2014 Q42, Marcel Duin <marcel@q42.nl> | MIT Licensed, https://github.com/Q42/DecorJS/blob/master/LICENSE
if(!window.$){$=function(a){return new _$(a)};$.extend=function(){function a(c,d){for(var g in c){var k=c[g],m=k&&k.constructor;d[g]=b&&m&&(m==Array||m==Object)?a(k,new m):!m||m!=Number&&m!=String?k:f&&m==String&&d[g]&&d[g].constructor==String?d[g]+" "+k:m(k)}return d}for(var c=arguments,b=!0===c[0],d=c[b&&1||0],f=c[b&&3||2],g=b?2:1;g<c.length;g++)a(c[g],d);return d};var _getEls=function(a,c){if(a==window)return[window];if(a instanceof Element)return[a];if(a instanceof Array||a instanceof _$)return a;
if(/^\</.test(a)){var b=document.createElement("div");b.innerHTML=a;return b.childNodes}return a?(c||document).querySelectorAll(a):[]},_$=function(a,c){var b=_getEls(a,c),d;for(d in b)this[d]=b[d];this.length||(this.length=b.length)};_$.prototype={each:function(a){for(var c=0;c<this.length;c++)a.call(this[c]);return this},remove:function(){this.each(function(){this.parentNode&&this.parentNode.removeChild(this)});return this},clone:function(a){var c=[];this.each(function(){var b=this.cloneNode(!a);
b._originalNode=this;c.push(b)});return $(c)},replaceWith:function(a){var c=this;c[0]&&(a.each?a.each(function(){c[0].parentNode.insertBefore(this,c[0])}):c[0].parentNode.insertBefore(a,c[0]),c.remove());return this},insertBefore:function(a){a=a.length?a[0]:a;this.each(function(){a.parentNode.insertBefore(this,a)})},appendTo:function(a){a=a.length?a[0]:a;this.each(function(){a.appendChild(this)});return this},append:function(a){this[0]&&$(a).appendTo(this[0]);return this},parent:function(){var a=
[];this.each(function(){0>a.indexOf(this.parentNode)&&a.push(this.parentNode)});return new _$(a)},closest:function(a){var c=[];this.each(function(){for(var b=this;b=b.parentNode;)if($(b).filter(a)[0])return 0>c.indexOf(b)&&c.push(b)});return new _$(c)},children:function(a){a=a||"*";var c=[];this.each(function(){for(var b=this.querySelectorAll(a),d=0;d<b.length;d++)b[d].parentNode==this&&c.push(b[d])});return new _$(c)},siblings:function(a){var c=[],b=this;this.parent().children().filter(a).each(function(){!b.has(this)&&
0>c.indexOf(this)&&c.push(this)});return new _$(c)},find:function(a){return new _$(a,this[0])},filter:function(a,c){a=$("<div>").append(this.clone(!0)).children(a);return new _$([].filter.call(this,function(b){for(var d=0;d<a.length;d++)if(a[d]._originalNode==b)return!c;return!!c}))},not:function(a){return this.filter(a,!0)},eq:function(a){return new _$(this[a])},has:function(a){for(var c=0;c<this.length;c++)if(this[c]==a)return!0},add:function(a){a=_getEls(a);for(var c=[],b=0;b<this.length;b++)c.push(this[b]);
a=c.concat([].filter.call(a,function(a){return-1==c.indexOf(a)}));return a.length==this.length?this:new _$(a)},attr:function(a,c){if(void 0===c)return this[0]&&this[0].getAttribute(a);this.each(function(){this[(null===c?"remove":"set")+"Attribute"](a,c)});return this},trigger:function(a,c){this.each(function(){var b=!isIE&&window.CustomEvent?new CustomEvent(a,{detail:c}):document.createEvent("CustomEvent");isIE&&b.initCustomEvent(a,!1,!1,c);this.dispatchEvent(b)});return this},on:function(a,c){a=
a.split(" ");this.each(function(){for(var b in a)this.addEventListener(a[b],c)});return this},off:function(a,c){a=a.split(" ");this.each(function(){for(var b in a)this.removeEventListener(a[b],c)});return this},click:function(a){if(a instanceof Function)this.on("click",a);else this.trigger("click");return this},text:function(a){if(void 0===a)return this[0]&&this[0].textContent;this.each(function(){this.textContent=a});return this},html:function(a){if(void 0===a)return this[0]&&this[0].innerHTML;this.each(function(){this.innerHTML=
a});return this},hasClass:function(a,c){c=0;this.each(function(){c+=this.classList.contains(a)&&1||0});return!!c},addClass:function(a){a=a.split(" ");this.each(function(){for(var c in a)a[c]&&this.classList.add(a[c])});return this},removeClass:function(a){a=a.split(" ");this.each(function(){for(var c in a)a[c]&&this.classList.remove(a[c])});return this},toggleClass:function(a){a=a.split(" ");for(var c in a)if(a[c])this[(this.hasClass(a[c])?"remove":"add")+"Class"](a[c]);return this},setcss:function(a,
c){this.each(function(){this.style.setProperty(a,c)});return this},getcss:function(a){return this[0]&&this[0].style.getPropertyValue(a)},css:function(a,c){if("string"==typeof a){if(void 0===c)return this.getcss(a);this.setcss(a,c)}else for(var b in a)this.setcss(b,a[b]);return this},hide:function(){this.setcss("display","none");return this},show:function(){this.setcss("display","block");return this},width:function(){return this[0]&&this[0].clientWidth},height:function(){return this[0]&&this[0].clientHeight}}}
$.browser||($.browser=new function(){var a=navigator.userAgent.toLowerCase();this.webkit=/applewebkit/.test(a);this.firefox=/firefox/.test(a);this.safari=/safari/.test(a)&&!/chrome/.test(a);this.ie=/msie/.test(a)||/trident/.test(a);this.iemobile=/iemobile/.test(a);this.iOS=/ipad|iphone|ipod/.test(a);this.android=/android/.test(a);this.mobile=this.iOS||this.android||this.iemobile;this.unknown=!this.webkit&&!this.firefox&&!this.ie&&!this.iOS&&!this.android;this.version=parseFloat(this.webkit?a.match(/applewebkit\/(\d+)\./)[1]:
this.firefox?a.match(/firefox\/(\d+)\./)[1]:this.ie?a.match(/(msie\s|rv\:)(\d+)\./)[2]:-1);this.retina=window.devicePixelRatio&&2<=window.devicePixelRatio&&this.iOS});$.events||($.events={getEvent:function(a){return a.changedTouches&&a.changedTouches[0]||a.touches&&a.touches[0]||a},getPageX:function(a){return $.events.getEvent(a).pageX},getPageY:function(a){return $.events.getEvent(a).pageY},getClientX:function(a){return $.events.getEvent(a).clientX},getClientY:function(a){return $.events.getEvent(a).clientY}});
Decor=new function(){var a=this;isWebkit=$.browser.webkit;isFirefox=$.browser.firefox;isSafari=$.browser.safari;isIE=$.browser.ie;isIOS=$.browser.iOS;isAndroid=$.browser.android;isMobile=$.browser.mobile;var c=document.documentElement.classList;isWebkit&&c.add("webkit");isFirefox&&c.add("firefox");isIE&&c.add("ie");isIOS&&c.add("ios");isAndroid&&c.add("android");isMobile&&c.add("mobile");this.compatible=isWebkit&&530<=$.browser.version||isFirefox&&21<=$.browser.version||isIE&&10<=$.browser.version||
isMobile;c3p=isWebkit||isIOS?"-webkit-":"";c3={perspective:c3p+"perspective",transform:c3p+"transform",transition:c3p+"transition",transitionD:c3p+"transition-duration",transitionTF:c3p+"transition-timing-function",animation:c3p+"animation"};c3d={transform:(isWebkit||isIOS?"webkitT":"t")+"ransform",transition:(isWebkit||isIOS?"webkitT":"t")+"ransition",animation:(isWebkit||isIOS?"webkitA":"a")+"animation"};$window=$(window);var b={};this.Scenes={};this.Things={};this.reloadScene=function(){a.resetTo(Decor.currentScene.name)()};
this.reset=function(){var b=null,c;for(c in Decor.Scenes){b=c;break}a.resetTo(b)()};this.resetTo=function(c){return function(){Decor.currentScene&&Decor.currentScene.hide(function(){localStorage.removeItem("currentScene");Decor.currentScene=null;for(var f in b)a.delete(f);a.goto(c)()})}};this.resetHard=function(){localStorage.removeItem("currentScene");Decor.currentScene?Decor.currentScene.hide(function(){location.reload()}):location.reload()};this.goto=function(a,c){return function(g){function h(){(b[a]||
(b[a]=new Decor.Scene(a,l))).show()}var e=Decor.currentScene;if(!e||e.name!=a){g&&g.target&&(g.stopPropagation(),g.preventDefault());var l=Decor.Scenes[a];if(!l)return console.error("Scene ["+a+"] not found");if(e)e[c?"delete":"hide"](h);else h()}}};this.delete=function(a){function c(){delete b[a]}b[a]&&(b[a].deleted?c():b[a].delete(c))}};
Decor.Scene=function(a,c){function b(){if(!m){$(document.body).removeClass("done-loading");m=!0;e.$[0].scrollLeft=0;f();for(var a=0;a<c.objects.length;a++)e.addThing(c.objects[a],!0);setTimeout(function(){if(c.oninit)c.oninit(e);r||d();n=r})}}function d(){c.scrollLeft&&e.camera.setPosition([10*(c.scrollLeft||0),0,0]);e.$.addClass("loaded");e.show()}function f(){clearTimeout(s);s=setTimeout(g,20);e.$.addClass("resizing");p||(p=e.$[0].scrollLeft/e.$[0].scrollWidth);var a=[innerWidth,innerWidth/l];a[1]>
innerHeight&&(a=[innerHeight*l,innerHeight]);var b={"margin-left":(e.margin[0]=c.fullWidth?0:Math.round((innerWidth-a[0])/2))+"px","margin-top":(e.margin[1]=Math.round((innerHeight-a[1])/2))+"px"};c.fixedSize&&c.res?e.$.css(c3.transform,"scale("+(e.scale=a[0]/k[0])+")"):(e.width=Math.round(a[0]),b.width=(c.fullWidth?innerWidth:e.width)+"px",b.height=(e.height=Math.round(a[1]))+"px");b[c3.perspective]=(c.fixedPerspective||e.width)+"px";e.$.css(b).trigger("scene-resize")}function g(){e.$.removeClass("resizing");
p&&(e.$[0].scrollLeft=e.camera.position[2]?0:Math.round(p*e.$[0].scrollWidth));p=0}function h(a){for(var b in e.objects)e.objects[b].destroy&&e.objects[b].destroy();e.$.remove();delete e.$;e.deleted=!0;a&&a()}c=$.extend(!0,{},c);var e=this,l=c.aspectRatio||16/9,k=c.res||[innerWidth,innerHeight*l],m=!1,r=0,n=0,p=0,s=null;c.width=c.width||1;c.height=c.height||1;this.name=a;this.data=c;this.width=k[0];this.height=k[1];this.scale=1;this.objects=[];this.shown=!1;this.collisionObjects=[];this.margin=[0,
0];this.camera=new Decor.Camera(this);this.deleted=this.active=!1;this.$=$("<scene>").addClass(a).css({width:k[0]+"px",height:k[1]+"px"}).appendTo(document.body);c.class&&this.$.addClass(c.class);c.scrolling&&(1<c.width&&$('<div class="canvas">').css("width",100*c.width+"%").appendTo(this.$),1<c.height&&$('<div class="canvas vert">').css("height",100*c.height+"%").appendTo(this.$));this.imageLoaded=function(){--r||d();if(n){var a=20*Math.round(5*((n-r)/n));$(document.body).addClass("loaded-"+a)}};
this.getThing=function(a){for(var b in e.objects)if(e.objects[b].name==a)return e.objects[b]};this.addThing=function(a,b){a.o=a.o||{};if(a.o.noIE&&isIE)return null;var d,f,k;for(k in a){d=k;f=a[k];break}c.prototypes&&/^\$/.test(f)&&(f=f.substr(1),a.o=$.extend(a.o,c.prototypes[f],!0),f=f.toLowerCase());a.o.name&&(f=a.o.name);a.o.img&&r++;k=Decor.Things[d];if(!k)return console.error("Object type "+d+" not found");d=e;var g=a.o,g=g||{};g.dims=g.dims||[1,1];g.pos=g.pos&&g.pos.length&&[g.pos[0]||0,g.pos[1]||
0,g.pos[2]||0]||[0,0,0];g.rot=g.rot||[0,0,0];k=new k(d,f,a.o=g);k.name=f;k.attr=a.o;b||c.objects.push(a);this.sortThing(k);return k};this.sortThing=function(a,b){var c=e.objects.indexOf(a);0<=c&&e.objects.splice(c,1);var d=e.objects.length,f;for(f in e.objects)if(a.attr.pos[2]<=e.objects[f].attr.pos[2]){d=f;break}e.objects.splice(d,0,a);b&&(0<=c&&d!=c||0>c)&&e.placeThing(a);return d};this.placeThing=function(a){if(!a.$cnt)return console.warn("Trying to place thing without container");setTimeout(function(){var b=
e.objects.indexOf(a);if(0>b)return console.warn("Trying to place object not in scene");for(b+=1;b<e.objects.length;b++)if(e.objects[b].$cnt&&e.objects[b].$cnt.parent()[0]==e.$[0]){a.$cnt.insertBefore(e.objects[b].$cnt);break}a.$cnt.parent()[0]!=e.$[0]&&a.$cnt.appendTo(e.$)})};this.getCooFromPx=function(a,b){var c=[(a-e.margin[0])/e.width,(b-e.margin[1])/e.height];if(!(0>c[0]||0>c[1]||1<c[0]||1<c[1]))return[c[0]+e.camera.position[0],1-c[1]+e.camera.position[1],e.camera.position[2]]};this.show=function(){if(!e.shown){if(m)f();
else return b();Decor.currentScene&&Decor.currentScene.hide();Decor.currentScene=this;localStorage.setItem("currentScene",a);e.$.show().addClass("placed");e.shown=!0;e.active=!0;addEventListener("resize",f);c.audio&&Decor.Audio.play(c.audio.src,c.audio);e.$.trigger("scene-show",a);onbeforeunload=function(){e.delete()};setTimeout(function(){e.$.addClass("shown");$(document.body).addClass("done-loading scene-shown").removeClass("loaded-"+[0,20,40,60,80,100].join(" loaded-"));if(c.onshow)c.onshow(e)})}};
this.hide=function(b,d){if(!e.shown)return b&&b();e.shown=!1;e.active=!1;e.$.removeClass("shown").addClass("hiding");$(document.body).removeClass("scene-shown");removeEventListener("resize",f);c.audio&&Decor.Audio.stop(c.audio.src);setTimeout(function(){e.$.removeClass("placed hiding").hide();$window.add(e.$).trigger("scene-hide",a);b&&b()},c.hideDuration||0)};this.delete=function(a){e.shown?e.hide(function(){h(a)}):h(a)}};
Decor.Camera=function(a){function c(b){if(!(!b instanceof Function))for(var c in a.objects){var d=a.objects[c];d.matrix&&(d.attr.main||b.call(d))}}function b(){var a={};a[c3.transitionTF]="";a[c3.transitionD]="";c(function(){this.$cnt.css(a)})}var d=this,f=a.data.height-1,g=a.data.limitCamera,h=a.data.cameraPosition,e=[0,0,0],l=e+"";this.offset=[0,f,0];Object.defineProperty(this,"position",{get:function(){return[e[0]+a.$[0].scrollLeft/a.$[0].scrollWidth*a.data.width,e[1]+a.$[0].scrollTop/a.$[0].scrollHeight*
a.data.height,e[2]]}});this.panTo=function(a,e,f,g){if(a instanceof Array){clearTimeout(null);var h={};h[c3.transitionTF]=f||"ease-in-out";h[c3.transitionD]=(e||0)/1E3+"s";c(function(){this.$cnt.css(h)});d.setPosition(a,g);setTimeout(b,e+50)}};this.setPosition=function(b,d){var h=b+"";l!=h&&(l=h,e[0]=g?Math.min(a.data.width,Math.max(-1,b[0])):b[0],e[1]=g?Math.min(f,Math.max(0,b[1])):b[1],e[2]=b[2],c(function(){this.place(d)}))};this.reset=function(a){d.panTo([0,0,0],a,null,!0)};this.resetZ=function(a){d.panTo([d.position[0],
d.position[1],0],a,null,!0)};h&&setTimeout(function(){2==h.length&&h.push(0);d.setPosition(h)})};
Decor.Object3D=function(a,c,b){var d=this;this.matrix=new Decor.Mat3D(this,b.pos,b.rot,b.scale);this.notInView=!1;this.reset=function(){d.matrix.translate(null,!0);return d};this.setPosition=function(c){b.pos[0]=c[0];b.pos[1]=c[1];b.pos[2]!=c[2]&&(b.pos[2]=c[2],a.sortThing(d,d.$cnt&&d.$cnt.parent()[0]==a.$[0]));d.reset().place()};this.translate=function(a,b){d.matrix.translate(a);d.place();return d};this.setNotInView=function(a){d.notInView!=a&&((d.notInView=a)?c.hide():c.show())};this.place=function(a){c[0].style[c3d.transform]=
d.matrix.getCSS(a)};this.focus=function(f){var g="zoom-out";if(c.toggleClass("open").hasClass("open")){g="zoom-in";a.$.find(".open").not(c).removeClass("open");var h=d.matrix.getPosition(),e=d.$.width(),l=d.$.height();l>a.height?h[2]-=a.height-1.05*l:e>a.width&&(h[2]-=(a.width-e)/2);h[0]-=(1-(b.width||0))/2;h[1]*=-1;h[2]*=-1;f instanceof Array&&(h[0]+=f[0],h[1]+=f[1],f[2]&&(h[2]+=f[2]));a.currentFocus=d;a.camera.panTo(h,a.data.focusDuration||0)}else a.currentFocus=null,a.camera.reset(a.data.focusDuration||
0);a.$.trigger(g,d.name)};this.place();a.$.on("scene-resize",d.place)};
Decor.Mat3D=function(a,c,b,d){function f(a){a=a?a.length?a:[a||1,a||1,1]:[1,1,1];2==a.length&&a.push(1);return a}c=c||[0,0,0];b=b||[0,0,0];d=f(d);var g=this,h=a.scene,e=[0,0,0],l=[a.rwidth,a.rheight];this.getQuad=function(a){a=a||[0,0,0];var b=g.getPosition();return{l:b[0]+a[0],r:b[0]+a[0]+l[0],t:-(b[1]-a[1]),b:-(b[1]-a[1]-l[1])}};this.intersects=function(a){var b=g.getQuad();return!(a.l>b.r||a.r<b.l||a.t>b.b||a.b<b.t)};this.getCSS=function(f){var g=a.scene.camera.offset,l=a.scene.camera.position,
n=a.attr.relative?0:l[0],p=a.attr.relative?0:g[1]-(h.data.height-1)-l[1],s=[h.width,h.height],q=[],t=h.data.depthFactor||1;f||(n-=h.$[0].scrollLeft/h.width);f=[Math.round(s[0]*(c[0]+e[0]+g[0]-n)),-Math.round(s[1]*(c[1]+e[1]+p)),t*(c[2]+e[2]+l[2])+g[2]];q.push("translate3d("+f.join("px,")+"px)");b[0]&&q.push("rotateX("+b[0]+"deg)");b[1]&&q.push("rotateY("+b[1]+"deg)");b[2]&&q.push("rotateZ("+b[2]+"deg)");1==d[0]&&1==d[1]&&1==d[2]||q.push("scale3d("+d.join(",")+")");return q.join(" ")};this.getPosition=
function(a){return[c[0]+e[0],c[1]+e[1],c[2]+e[2]]};this.getElementPosition=function(){var b=g.getPosition(),c=getComputedStyle(a.$[0])[c3.transform];/^matrix\(/.test(c)&&(c=c.substr(0,c.length-1).split(","),b[0]+=parseFloat(c[4])/h.width,b[1]+=parseFloat(c[5])/h.height);return b};this.getX=function(){return c[0]+e[0]};this.getY=function(){return c[1]+e[1]};this.getZ=function(){return c[2]+e[2]};this.translate=function(a,b){b&&(e=[0,0,0]);a&&(e[0]+=a[0],e[1]+=a[1],e[2]+=a[2]);return g};Object.defineProperty(this,
"xyz",{get:function(){return c},set:function(a){c=a}});Object.defineProperty(this,"rot",{get:function(){return b},set:function(a){b=a}});Object.defineProperty(this,"scale",{get:function(){return d},set:function(a){d=f(a)}})};
Decor.Frame=new function(){function a(f){if(c.length){for(var g=c.length;g--;)c.shift()(f);d=requestAnimationFrame(a)}else b&&(b=!1,cancelAnimationFrame(d))}var c=[],b=!1,d=null;this.request=function(f){1==c.push(f)&&(b||(b=!0,d=requestAnimationFrame(a)))};this.cancel=function(a){for(var g=0;g<c.length;g++)a==c[g]&&c.shift();!c.length&&b&&(b=!1,cancelAnimationFrame(d))}};
Decor.Audio=new function(){function a(a,b){b=b||{};this.audio=new Audio;this.audio.volume=b.volume||1;this.audio.src=this.src=a;this.play()}function c(a){(isIE||isIOS||isSafari)&&/\.ogg$/.test(a)&&(a=a.replace(/\.ogg/,".mp3"));return a}var b=[];a.prototype={playing:!1,play:function(){this.audio&&!this.playing&&(this.playing=!0,this.audio.load(),this.audio.play(),this.audio.addEventListener("ended",this.stop))},stop:function(){this.playing&&(this.playing=!1,this.audio.pause())}};this.play=function(d,
f){d=c(d);var g;a:{for(g in b)if(b[g].src==d&&!b[g].playing){g=b[g];break a}g=void 0}g?g.play.call(g):b.push(g=new a(d,f));return g.audio};this.stop=function(a){a=c(a);for(var f in b)b[f].src==a&&b[f].stop.call(b[f])}};
Decor.Things.Thing=function(a,c,b){var d=this;this.attr=b;this.scene=a;var f=$('<thing class="thing">');this.$cnt=f;this.$=b.static?f:$("<thing>").appendTo(f);this.$[0].thing=f[0].thing=this;b.static&&f.addClass("static");this.$.addClass(c+(b.class?" "+b.class:""));this.$cnt.addClass(c+"-cnt");b.clickable&&f.addClass("clickable");b.textContent&&this.$.text(b.textContent);this.setDims=function(){var c=b.isDepth?a.height/1080:1;d.$.css({width:(d.width=b.px&&b.px[0]||Math.round(b.dims[0]*a.width))+"px",
height:d.height=b.px&&b.px[1]||Math.round(b.dims[1]/c*a.height)+"px"});d.rwidth=b.px?b.px[0]/a.width:b.dims[0];d.rheight=b.px?b.px[1]/a.height:b.dims[1]};this.show=function(){a.placeThing(d)};this.hide=this.destroy=function(){f.remove()};Decor.Object3D.call(this,a,f,b);a.$.on("scene-resize",this.setDims);this.setDims();b.noshow||this.show()};Decor.Things.Static=function(a,c,b){b.static=!0;Decor.Things.Thing.call(this,a,c,b)};
Decor.Things.HTMLContain=function(a,c,b){function d(){f.$cnt.css("font-size",b.relativeFontSize*a.height+"px")}var f=this;Decor.Things.Static.call(this,a,c,b);$("body>"+b.selector+",body>*:not(scene) "+b.selector).hide().clone().show().appendTo(this.$cnt);b.watch&&(f.$cnt.addClass("hidden"),a.$.on("zoom-in zoom-out",function(a){"zoom-in"==a.type&&a.detail==b.watch?f.$cnt.removeClass("hidden"):f.$cnt.addClass("hidden")}));b.relativeFontSize&&(a.$.on("scene-show scene-resize",d),a.shown&&d())};
Decor.Things.ImageContain=function(a,c,b){function d(){var a=e.offsetHeight*h.width()/e.offsetWidth,b=Math.round(a*m[0][1]);l.css({height:a-b,bottom:b})}b.width&&(b.dims=[b.width,0]);var f=this,g=b.px?b.px[0]+"px":100*b.dims[0]+"%",h=$("<"+(b.tagName||"thing")+' class="thing">').css("width",g);this.scene=a;var e=null,e=new Image;e.thing=f;e.onload=function(m){b.dims[1]=b.dims[0]*e.height/e.width;f.rwidth=b.dims[0];f.rheight=b.dims[1];k&&d();f.$.addClass("image "+c);b.static&&(f.$.css("width",g),f.$cnt.replaceWith(f.$),
f.$cnt=h=f.$);h.addClass(c+"-cnt");b.clickable&&h.addClass("clickable");b.class&&h.addClass(b.class);Decor.Object3D.call(f,a,h,b);b.clickable&&b.clickToFocus&&(k?l:f.$).click(f.focus);b.static||f.$.appendTo(f.$cnt);if(f.onload)f.onload();a.imageLoaded(c)};e.onerror=a.imageLoaded;e.src=b.img;f.$=$(e).addClass("thing");f.$cnt=h;h[0].thing=this;var l=$(),k=b.clickable&&b.clickable.length;isIE&&11>$.browser.version&&(k=!1);var m=b.clickable&&b.clickable.length?b.clickable:[[0,0],[1,1]];b.clickable&&k&&
(h.addClass("has-area"),l=$('<div class="click-area">').css({left:100*m[0][0]+"%",width:100*(m[1][0]-m[0][0])+"%"}).appendTo(h));if(k)a.$.on("scene-resize",d);this.show=function(){a.placeThing(f)};this.hide=this.destroy=function(){h.remove()};b.noshow||this.show()};Decor.Things.Image=function(a,c,b){b.static=!0;Decor.Things.ImageContain.call(this,a,c,b)};
Decor.Things.ImageLink=function(a,c,b){b.tagName="a";Decor.Things.ImageContain.call(this,a,c,b);this.$cnt[0].href=b.href;b.external&&(this.$cnt[0].target="_blank");b.title&&(this.$cnt[0].title=b.title)};
Decor.Things.ImageBG=function(a,c,b){var d=this;b.class="imagebg "+(b.class||"");Decor.Things.Static.call(this,a,c,b);if(b.width){b.dims[0]=b.width;b.dims[1]=0;var f=new Image;f.onload=function(){b.dims[1]=b.dims[0]*f.height/f.width/(a.height/a.width);d.setDims();a.imageLoaded()};f.src=b.img}else a.imageLoaded();this.$.css("background-image","url("+b.img+")")};
Decor.Things.ImageRep=function(a,c,b){a.imageLoaded();for(var d=0;d<b.repeat;d++)a.addThing({Image:c,o:$.extend(b,{img:b.img,width:b.width,pos:[b.pos[0]+d*b.width,b.pos[1],b.pos[2]]})})};Decor.Things.ThingRep=function(a,c,b){for(var d=0;d<b.repeat;d++)a.addThing({Thing:c,o:$.extend(b,{dims:b.dims,px:b.px,pos:[b.pos[0]+d*b.trans[0],b.pos[1]+d*b.trans[1],b.pos[2]-d*b.trans[2]]})})};
Decor.Things.Cube=function(a,c,b){function d(){f.$.children(".side:not(.front)").each(function(){var c=$(this),d=Math.sqrt(Math.pow(a.width/2,2)+Math.pow(a.height/2,2))*b.dims[2];"back"==this.sideType?c.css(c3.transform,"rotateY(180deg) translate3d(0,0,"+d+"px"):c.css("bottom"==this.sideType||"top"==this.sideType?"height":"width",d+"px")})}var f=this,g={back:1,bottom:1,top:1,right:1,left:1,front:1};if(b.sides)for(var h in b.sides)g[h]=b.sides[h];b.dims[2]=b.dims[2]||b.dims[0];b.class=(b.class||"")+
" cube";Decor.Things.Thing.call(this,a,c,b);this.$cnt.add(this.$).addClass("preserve-3d");for(h in g)g[h]&&($('<div class="side '+h+'">').appendTo(this.$)[0].sideType=h);a.$.on("scene-resize",d);d()};
Decor.Things.Overlay=function(a,c,b){function d(){var c={left:a.$[0].offsetLeft+Math.round(a.width*b.pos[0])+"px",top:a.$[0].offsetTop+Math.round(a.height*b.pos[1])+"px"};if(0<b.dims[0]||b.px&&0<b.px[0])c.width=b.px?b.px[0]:Math.round(a.width*b.dims[0])+"px";if(0<b.dims[1]||b.px&&0<b.px[1])c.height=b.px?b.px[1]:Math.round(a.height*b.dims[1])+"px";f.$cnt.css(c)}var f=this,g=$("body>"+b.selector+",body>*:not(scene) "+b.selector).hide().clone().show();this.$cnt=$('<div class="overlay '+c+(b.class?" "+
b.class:"")+'">');this.$=(g[0]?g:$("<div>")).appendTo(this.$cnt);this.show=function(){f.$cnt.appendTo(document.body)};this.hide=this.destroy=function(){f.$cnt.remove()};a.$.on("scene-show scene-resize",d);a.shown&&d();b.noshow||this.show()};
