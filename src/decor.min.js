// DecorJS - v0.4 | https://github.com/Q42/DecorJS | (c) 2014 Q42, Marcel Duin <marcel@q42.nl> | MIT Licensed, https://github.com/Q42/DecorJS/blob/master/LICENSE
if(!window.$){$=function(b){return new _$(b)};$.extend=function(){function b(c,d){for(var e in c){var f=c[e],l=f&&f.constructor;d[e]=a&&l&&(l==Array||l==Object)?b(f,new l):a&&l&&(l==Number||l==String)?l(f):f}return d}for(var c=arguments,a=!0===c[0],d=c[a&&1||0],f=a?2:1;f<c.length;f++)b(c[f],d);return d};$.browser=new function(){var b=navigator.userAgent.toLowerCase();this.webkit=/applewebkit/.test(b);this.firefox=/firefox/.test(b);this.ie=/msie/.test(b)||/trident/.test(b);this.iOS=/ipad|iphone|ipod/.test(b);
this.android=/android/.test(b);this.mobile=this.iOS||this.android;this.unknown=!this.webkit&&!this.firefox&&!this.ie&&!this.iOS&&!this.android;b=this.webkit?b.match(/applewebkit\/(\d+)\./)[1]:this.firefox?b.match(/firefox\/(\d+)\./)[1]:this.ie?b.match(/(msie\s|rv\:)(\d+)\./)[2]:-1;this.version=parseFloat(b)};var _getEls=function(b,c){if(b==window)return[window];if(b instanceof Element)return[b];if(b instanceof Array||b instanceof _$)return b;if(/^\</.test(b)){var a=document.createElement("div");a.innerHTML=
b;return a.childNodes}return b?(c||document).querySelectorAll(b):[]},_$=function(b,c){var a=_getEls(b,c),d;for(d in a)this[d]=a[d];this.length||(this.length=a.length)};_$.prototype={each:function(b){for(var c=0;c<this.length;c++)b.call(this[c]);return this},remove:function(){this.each(function(){this.parentNode.removeChild(this)});return this},replaceWith:function(b){var c=this;c[0]&&(b.each?b.each(function(){c[0].parentNode.insertBefore(this,c[0])}):c[0].parentNode.insertBefore(b,c[0]),c.remove());
return this},appendTo:function(b){b=b.length?b[0]:b;this.each(function(){b.appendChild(this)});return this},parent:function(){var b=[];this.each(function(){0>b.indexOf(this.parentNode)&&b.push(this.parentNode)});return new _$(b)},children:function(b){b=b||"*";var c=[];this.each(function(){for(var a=this.querySelectorAll(b),d=0;d<a.length;d++)a[d].parentNode==this&&c.push(a[d])});return new _$(c)},find:function(b){return new _$(b,this[0])},filter:function(b,c){b=_getEls(b);return new _$([].filter.call(this,
function(a){for(var d=0;d<b.length;d++)if(b[d]==a)return!c;return!!c}))},not:function(b){return this.filter(b,!0)},eq:function(b){return new _$(this[b])},has:function(b){for(var c=0;c<this.length;c++)if(this[c]==b)return!0},add:function(b){b=_getEls(b);for(var c=[],a=0;a<this.length;a++)c.push(this[a]);b=c.concat([].filter.call(b,function(b){return-1==c.indexOf(b)}));return b.length==this.length?this:new _$(b)},attr:function(b,c){if(void 0===c)return this[0]&&this[0].getAttribute(b);this.each(function(){this[(null===
c?"remove":"set")+"Attribute"](b,c)});return this},trigger:function(b,c){this.each(function(){var a=isIE?document.createEvent("CustomEvent"):new CustomEvent(b,{detail:c});isIE&&a.initCustomEvent(b,!1,!1,c);this.dispatchEvent(a)});return this},on:function(b,c){b=b.split(" ");this.each(function(){for(var a in b)this.addEventListener(b[a],c)});return this},off:function(b,c){b=b.split(" ");this.each(function(){for(var a in b)this.removeEventListener(b[a],c)});return this},click:function(b){if(b instanceof
Function)this.on("click",b);else this.trigger("click");return this},text:function(b){if(void 0===b)return this[0]&&this[0].textContent;this.each(function(){this.textContent=b});return this},html:function(b){if(void 0===t)return this[0]&&this[0].innerHTML;this.each(function(){this.innerHTML=b});return this},hasClass:function(b,c){c=0;this.each(function(){c+=this.classList.contains(b)&&1||0});return!!c},addClass:function(b){b=b.split(" ");this.each(function(){for(var c in b)this.classList.add(b[c])});
return this},removeClass:function(b){b=b.split(" ");this.each(function(){for(var c in b)this.classList.remove(b[c])});return this},toggleClass:function(b){b=b.split(" ");for(var c in b)this[(this.hasClass(b[c])?"remove":"add")+"Class"](b[c]);return this},setcss:function(b,c){this.each(function(){this.style.setProperty(b,c)});return this},getcss:function(b){return this[0]&&this[0].style.getPropertyValue(b)},css:function(b,c){if("string"==typeof b){if(void 0===c)return this.getcss(b);this.setcss(b,
c)}else for(var a in b)this.setcss(a,b[a]);return this},hide:function(){this.setcss("display","none");return this},show:function(){this.setcss("display","block");return this},width:function(){return this[0]&&this[0].clientWidth},height:function(){return this[0]&&this[0].clientHeight}}}
Decor=new function(){var b=this;isWebkit=$.browser.webkit;isFirefox=$.browser.firefox;isIE=$.browser.ie;isIOS=$.browser.iOS;isAndroid=$.browser.android;isMobile=$.browser.mobile;var c=document.firstChild.classList;isWebkit&&c.add("webkit");isFirefox&&c.add("firefox");isIE&&c.add("ie");isIOS&&c.add("ios");isAndroid&&c.add("android");isMobile&&c.add("mobile");this.compatible=isWebkit&&530<=$.browser.version||isFirefox&&21<=$.browser.version||isIE&&10<=$.browser.version||isMobile;c3p=isWebkit||isIOS?
"-webkit-":"";c3={transform:c3p+"transform",transition:c3p+"transition",animation:c3p+"animation"};c3d={transform:(isWebkit||isIOS?"webkitT":"t")+"ransform",transition:(isWebkit||isIOS?"webkitT":"t")+"ransition",animation:(isWebkit||isIOS?"webkitA":"a")+"animation"};$window=$(window);var a={};this.Scenes={};this.Things={};this.reloadScene=function(){b.resetTo(Decor.currentScene.name)()};this.reset=function(){var a=null,c;for(c in Decor.Scenes){a=c;break}b.resetTo(a)()};this.resetTo=function(c){return function(){Decor.currentScene&&
Decor.currentScene.hide(function(){localStorage.removeItem("currentScene");Decor.currentScene=null;for(var f in a)b.delete(f);b.goto(c)()})}};this.resetHard=function(){localStorage.removeItem("currentScene");Decor.currentScene?Decor.currentScene.hide(function(){location.reload()}):location.reload()};this.goto=function(b){return function(c){function g(){(a[b]||(a[b]=new Decor.Scene(b,e))).show()}var h=Decor.currentScene;if(!h||h.name!=b){c&&c.target&&(c.stopPropagation(),c.preventDefault());var e=
Decor.Scenes[b];if(!e)return console.error("Scene ["+b+"] not found");h?h.hide(g):g()}}};this.delete=function(b){function c(){delete a[b]}a[b]&&(a[b].deleted?c():a[b].delete(c))}};
Decor.Scene=function(b,c){function a(){if(!p){$(document.body).removeClass("done-loading");p=!0;e.$[0].scrollLeft=0;f();for(var b=0;b<c.objects.length;b++){var a=c.objects[b];a.o=a.o||{};if(!a.o.noIE||!isIE){var g,l,h;for(h in a){g=h;l=a[h];break}c.prototypes&&/^\$/.test(l)&&(l=l.substr(1),a.o=$.extend(a.o,c.prototypes[l]),l=l.toLowerCase());a.o.img&&q++;var n=Decor.Things[g];if(n){var k=e,m=l,a=(a=a.o)||{};a.dims=a.dims||[1,1];a.pos=a.pos||[0,0,0];a.rot=a.rot||[0,0,0];a=new n(k,m,a);a.name=l;e.objects.push(a)}else console.error("Object type "+
g+" not found")}}if(c.oninit)c.oninit(e);q||d();r=q}}function d(){c.scrollLeft&&e.camera.setPosition([10*(c.scrollLeft||0),0,0]);e.$.addClass("loaded");e.show()}function f(){clearTimeout(s);s=setTimeout(g,20);e.$.addClass("resizing");m||(m=e.$[0].scrollLeft/e.$[0].scrollWidth);var a=[innerWidth,innerWidth/k];a[1]>innerHeight&&(a=[innerHeight*k,innerHeight]);var b={"margin-left":e.margin[0]=c.fullWidth?0:Math.round((innerWidth-a[0])/2),"margin-top":e.margin[1]=Math.round((innerHeight-a[1])/2)};c.fixedSize&&
c.res?e.$.css(c3.transform,"scale("+(e.scale=a[0]/l[0])+")"):(e.width=Math.round(a[0]),b.width=c.fullWidth?innerWidth:e.width,b.height=e.height=Math.round(a[1]));e.$.css(b).trigger("scene-resize")}function g(){e.$.removeClass("resizing");m&&(e.$[0].scrollLeft=e.camera.position[2]?0:Math.round(m*e.$[0].scrollWidth));m=0}function h(a){for(var b in e.objects)e.objects[b].destroy&&e.objects[b].destroy();e.$.remove();delete e.$;e.deleted=!0;a&&a()}c=$.extend(!0,{},c);var e=this,k=16/9,l=c.res||[innerWidth,
innerHeight*k],n=!1,p=!1,q=0,r=0,m=0,s=null;c.width=c.width||1;c.height=c.height||1;this.name=b;this.data=c;this.width=l[0];this.height=l[1];this.scale=1;this.objects=[];this.collisionObjects=[];this.margin=[0,0];this.camera=new Decor.Camera(this);this.deleted=this.active=!1;this.$=$("<scene>").addClass(b).css({width:l[0],height:l[1]}).appendTo(document.body);c.scrolling&&1<c.width&&$('<div class="canvas">').css("width",100*c.width+"%").appendTo(this.$);this.imageLoaded=function(){--q||d();if(r){var a=
20*Math.round(5*((r-q)/r));$(document.body).addClass("loaded-"+a)}};this.addLoadImage=function(){q++;r++};this.getThing=function(a){for(var b in e.objects)if(e.objects[b].name==a)return e.objects[b]};this.show=function(){if(!n){if(p)f();else return a();Decor.currentScene&&Decor.delete(Decor.currentScene.name);Decor.currentScene=this;localStorage.setItem("currentScene",b);e.$.addClass("placed");n=!0;e.active=!0;addEventListener("resize",f);c.audio&&Decor.Audio.play(c.audio.src,c.audio);e.$.trigger("scene-show",
b);onbeforeunload=function(){e.delete(null,0)};setTimeout(function(){e.$.addClass("shown");$(document.body).addClass("done-loading scene-shown").removeClass("loaded-"+[0,20,40,60,80,100].join(" loaded-"))})}};this.hide=function(a,d){if(!n)return a&&a();n=!1;e.active=!1;e.$.removeClass("shown");$(document.body).removeClass("scene-shown");$window.add(e.$).trigger("scene-hide",b);removeEventListener("resize",f);c.audio&&Decor.Audio.stop(c.audio.src);setTimeout(function(){e.$.removeClass("placed");a&&
a()},isNaN(d)?1E3:d)};this.delete=function(a,b){n?e.hide(function(){h(a)},b):h(a)}};
Decor.Camera=function(b){function c(c){var d={l:a.position[0]-1,r:a.position[0]+2,t:a.position[1]-0.5,b:a.position[1]+1},e;for(e in b.objects){var f=b.objects[e];f.matrix&&(f.attr.main||(b.data.renderAll||f.matrix.intersects(d))&&c&&c.call(f))}}var a=this,d=b.data.height-1,f="0,0,0";this.offset=[0,d,0];this.position=[0,0,0];this.setPosition=function(g,h){var e=g+"";f!=e&&(f=e,a.position[0]=Math.min(b.data.width,Math.max(0,g[0])),a.position[1]=Math.min(d,Math.max(0,g[1])),a.position[2]=g[2],c(function(){this.place(h)}))};
this.reset=function(){a.setPosition([0,0,0],!0)};this.resetZ=function(){a.setPosition([a.position[0],a.position[1],0],!0)}};
Decor.Object3D=function(b,c,a){var d=this,f=null;this.matrix=new Decor.Mat3D(this,a.pos,a.rot,a.scale);this.notInView=!1;this.reset=function(){d.matrix.translate(null,!0);return d};this.setPosition=function(b){a.pos[0]=b[0];a.pos[1]=-b[1];a.pos[2]=b[2];d.reset().place()};this.translate=function(a,b){d.matrix.translate(a);d.place();return d};this.setNotInView=function(a){d.notInView!=a&&((d.notInView=a)?c.hide():c.show())};this.place=function(a){c[0].style[c3d.transform]=d.matrix.getCSS(a)};this.focus=
function(){if(b.dimmed&&c.hasClass("open"))return $(".nav.back").click();clearTimeout(f);b.$.addClass("animate");var g="zoom-out";if(c.toggleClass("open").hasClass("open")){g="zoom-in";b.$.find(".open").not(c).removeClass("open");var h=d.matrix.getPosition(),e=d.$.width(),k=d.$.height();k>b.height?h[2]-=b.height-1.05*k:e>b.width&&(h[2]-=(b.width-e)/2);h[0]-=(1-a.width)/2;h[2]*=-1;b.camera.setPosition(h)}else b.camera.resetZ();b.$.trigger(g,d.name);f=setTimeout(function(){b.$.removeClass("animate")},
500)};this.place();b.$.on("scene-resize",d.place)};
Decor.Mat3D=function(b,c,a,d){c=c||[0,0,0];a=a||[0,0,0];d=d?d.length?d:[d||1,d||1,1]:[1,1,1];2==d.length&&d.push(1);var f=this,g=b.scene,h=g.camera.position,e=[0,0,0],k=[b.rwidth,b.rheight];this.getQuad=function(a){a=a||[0,0,0];var b=f.getPosition();return{l:b[0]+a[0],r:b[0]+a[0]+k[0],t:-(b[1]-a[1]),b:-(b[1]-a[1]-k[1])}};this.intersects=function(a){var b=f.getQuad();return!(a.l>b.r||a.r<b.l||a.t>b.b||a.b<b.t)};this.getCSS=function(f){var k=b.scene.camera.offset,p=b.attr.relative?0:h[0],q=b.attr.relative?
0:k[1]-(g.data.height-1)-h[1],r=[g.width,g.height],m=[];f||(p-=g.$[0].scrollLeft/g.width);f=[Math.round(r[0]*(c[0]+e[0]+k[0]-p)),-Math.round(r[1]*(c[1]+e[1]+q)),Math.round(0.3*(c[2]+e[2]+h[2]))+k[2]];m.push("translate3d("+f.join("px,")+"px)");a[0]&&m.push("rotateX("+a[0]+"deg)");a[1]&&m.push("rotateY("+a[1]+"deg)");a[2]&&m.push("rotateZ("+a[2]+"deg)");1==d[0]&&1==d[1]&&1==d[2]||m.push("scale3d("+d.join(",")+")");return m.join(" ")};this.getPosition=function(a){return[c[0]+e[0],-(c[1]+e[1]),c[2]+e[2]]};
this.getElementPosition=function(){var a=f.getPosition(),c=getComputedStyle(b.$[0])[c3.transform];/^matrix\(/.test(c)&&(c=c.substr(0,c.length-1).split(","),a[0]+=parseFloat(c[4])/g.width,a[1]+=parseFloat(c[5])/g.height);return a};this.getX=function(){return c[0]+e[0]};this.getY=function(){return c[1]+e[1]};this.getZ=function(){return c[2]+e[2]+h[2]};this.translate=function(a,b){b&&(e=[0,0,0]);a&&(e[0]+=a[0],e[1]+=a[1],e[2]+=a[2]);return f}};
Decor.Frame=new function(){function b(f){if(c.length){for(var g=0;g<c.length;g++)c.shift()(f);d=requestAnimationFrame(b)}else a&&(a=!1,cancelAnimationFrame(d))}var c=[],a=!1,d=null;this.request=function(f){1==c.push(f)&&(a||(a=!0,d=requestAnimationFrame(b)))};this.cancel=function(b){for(var g=0;g<c.length;g++)b==c[g]&&c.shift();!c.length&&a&&(a=!1,cancelAnimationFrame(d))}};
Decor.Audio=new function(){function b(a,b){b=b||{};this.audio=new Audio;this.audio.volume=b.volume||1;this.audio.src=this.src=a;this.play()}function c(a){(isIE||isIOS)&&/\.ogg$/.test(a)&&(a=a.replace(/\.ogg/,".mp3"));return a}var a=[];b.prototype={playing:!1,play:function(){this.audio&&!this.playing&&(this.playing=!0,this.audio.load(),this.audio.play(),this.audio.addEventListener("ended",this.stop))},stop:function(){this.playing&&(this.playing=!1,this.audio.pause())}};this.play=function(d,f){d=c(d);
var g;a:{for(g in a)if(a[g].src==d&&!a[g].playing){g=a[g];break a}g=void 0}g?g.play.call(g):a.push(g=new b(d,f));return g.audio};this.stop=function(b){b=c(b);for(var f in a)a[f].src==b&&a[f].stop.call(a[f])}};
Decor.Things.Thing=function(b,c,a){function d(){var c=a.isDepth?b.height/1080:1;f.$.css({width:f.width=a.px&&a.px[0]||Math.round(a.dims[0]*b.width),height:f.height=a.px&&a.px[1]||100*(a.dims[1]/c)+"%"});f.rwidth=a.px?a.px[0]/b.width:a.dims[0];f.rheight=a.px?a.px[1]/b.height:a.dims[1]}var f=this;this.attr=a;this.scene=b;var g=$(a.static?"<thing>":'<dud class="dud">');g[0].thing=this;this.$cnt=g;c&&g.addClass(c+(a.static?" static":"")+(a.class?" "+a.class:""));this.$=a.static?g:$("<thing>").appendTo(g);
a.innerText&&this.$.text(a.innerText);b.$.on("scene-resize",d);d();this.show=function(){g.appendTo(b.$)};this.hide=function(){g.remove()};this.destroy=function(){g.remove()};Decor.Object3D.call(this,b,g,a);a.noshow||this.show()};Decor.Things.Static=function(b,c,a){a.static=!0;Decor.Things.Thing.call(this,b,c,a)};
Decor.Things.HTMLContain=function(b,c,a){var d=this;Decor.Things.Static.call(this,b,c,a);$(a.selector).appendTo(this.$cnt);a.watch&&(d.$cnt.addClass("hidden"),b.$.on("zoom-in zoom-out",function(b){"zoom-in"==b.type&&b.detail==a.watch?d.$cnt.removeClass("hidden"):d.$cnt.addClass("hidden")}));b.$.on("scene-show scene-resize",function(){var a=Math.max(8,16/1080*b.height);d.$cnt.css("font-size",a+"px")})};
Decor.Things.ImageContain=function(b,c,a){function d(){var a=k.offsetHeight*e.width()/k.offsetWidth,b=Math.round(a*p[0][1]);l.css({height:a-b,bottom:b})}a.width=a.width||1;a.dims=[a.width,0];var f=this,g=/\..{3}$/.test(a.img)?"":".png",g="img/"+a.img+g,h=a.px?a.px[0]:100*a.dims[0]+"%",e=$("<"+(a.tagName||"dud")+' class="dud">').css("width",h).appendTo(b.$);a.class&&e.addClass(a.class);this.attr=a;this.scene=b;var k=null,k=new Image;k.thing=f;k.onload=function(g){a.dims[1]=a.dims[0]*k.height/k.width;
f.rwidth=a.dims[0];f.rheight=a.dims[1];n&&d();f.$.addClass("image "+c);a.static&&(f.$.css("width",h),f.$cnt.replaceWith(f.$),e=f.$);Decor.Object3D.call(f,b,e,a);a.clickable&&(n?l:f.$).click(f.focus);a.static||f.$.appendTo(f.$cnt);if(f.onload)f.onload();b.imageLoaded(c)};k.onerror=b.imageLoaded;k.src=g;f.$=$(k);f.$cnt=e;e[0].thing=this;var l=$(),n=a.clickable&&a.clickable.length;isIE&&11>$.browser.version&&(n=!1);var p=a.clickable&&a.clickable.length?a.clickable:[[0,0],[1,1]];a.clickable&&(e.addClass("clickable"),
n&&(e.addClass("has-area"),l=$('<div class="click">').css({left:100*p[0][0]+"%",width:100*(p[1][0]-p[0][0])+"%"}).appendTo(e)));if(n)b.$.on("scene-resize",d);this.destroy=function(){e.remove()}};Decor.Things.Image=function(b,c,a){a.static=!0;Decor.Things.ImageContain.call(this,b,c,a)};Decor.Things.ImageLink=function(b,c,a){a.tagName="a";Decor.Things.ImageContain.call(this,b,c,a);this.$cnt[0].href=a.href;this.$cnt[0].target="_blank";a.title&&(this.$cnt[0].title=a.title)};
Decor.Things.ImageBG=function(b,c,a){Decor.Things.Static.call(this,b,c,a);b.imageLoaded();this.$cnt.css("background-image","url(img/"+a.img+".png)")};Decor.Things.ImageRep=function(b,c,a){b.imageLoaded();for(var d=0;d<a.repeat;d++)b.addLoadImage(),b.objects.push(new Decor.Things.Image(b,c,{img:a.img,width:a.width,pos:[a.pos[0]+d*a.width,a.pos[1],a.pos[2]]}))};
Decor.Things.ThingRep=function(b,c,a){for(var d=0;d<a.repeat;d++)b.objects.push(new Decor.Things.Thing(b,c,{dims:a.dims,px:a.px,pos:[a.pos[0]+d*a.trans[0],a.pos[1]+d*a.trans[1],a.pos[2]-d*a.trans[2]]}))};
Decor.Things.ImageCQuality=function(b,c,a){function d(){k&&g.$cnt[0].removeChild(k);k=null}function f(a){a=this instanceof Image&&this||a;g.$cnt[0].insertBefore(a,k||g.$[0].nextSibling);d();k=a}var g=this;a.quality=a.quality||[a.img.match(/\d*$/)[0]];a.default||(a.default=0);a.mobile&&isMobile&&(a.default=a.mobile);var h=a.img.replace(/\d*$/,"");a.img=h+a.quality[a.default];var e=Array(a.quality.length),k=null;Decor.Things.ImageContain.call(this,b,c,a);this.setQuality=function(b){if(b==a.default||
!a.quality[b])return k&&d();if(e[b])return f(e[b]);e[b]=new Image;e[b].onload=f;e[b].className="image no-events "+c;e[b].src="img/"+h+a.quality[b]+(/\..{3}$/.test(a.img)?"":".png")};if(!a.noMobile||!isMobile)b.$.on("zoom-in",function(b){b.detail==c?(b=a.medium||a.high,a.highTreshX&&a.medium&&(b=innerWidth>a.highTreshX?a.high:a.medium),g.setQuality(b)):d()}).on("zoom-out",d)};
