// DecorJS - v0.7 | https://github.com/Q42/DecorJS | (c) 2014 Q42, Marcel Duin <marcel@q42.nl> | MIT Licensed, https://github.com/Q42/DecorJS/blob/master/LICENSE
if(!window.$){$=function(a){return new _$(a)};$.extend=function(){function a(c,d){for(var f in c){var l=c[f],h=l&&l.constructor;d[f]=b&&h&&(h==Array||h==Object)?a(l,new h):!h||h!=Number&&h!=String?l:e&&h==String&&d[f]&&d[f].constructor==String?d[f]+" "+l:h(l)}return d}for(var c=arguments,b=!0===c[0],d=c[b&&1||0],e=c[b&&3||2],f=b?2:1;f<c.length;f++)a(c[f],d);return d};var _getEls=function(a,c){if(a==window)return[window];if(a instanceof Element)return[a];if(a instanceof Array||a instanceof _$)return a;
if(/^\</.test(a)){var b=document.createElement("div");b.innerHTML=a;return b.childNodes}return a?(c||document).querySelectorAll(a):[]},_$=function(a,c){var b=_getEls(a,c),d;for(d in b)this[d]=b[d];this.length||(this.length=b.length)};_$.prototype={each:function(a){for(var c=0;c<this.length;c++)a.call(this[c]);return this},remove:function(){this.each(function(){this.parentNode&&this.parentNode.removeChild(this)});return this},clone:function(a){var c=[];this.each(function(){var b=this.cloneNode(!a);
b._originalNode=this;c.push(b)});return $(c)},replaceWith:function(a){var c=this;c[0]&&(a.each?a.each(function(){c[0].parentNode.insertBefore(this,c[0])}):c[0].parentNode.insertBefore(a,c[0]),c.remove());return this},insertBefore:function(a){a=a.length?a[0]:a;this.each(function(){a.parentNode.insertBefore(this,a)})},appendTo:function(a){a=a.length?a[0]:a;this.each(function(){a.appendChild(this)});return this},append:function(a){this[0]&&$(a).appendTo(this[0]);return this},parent:function(){var a=
[];this.each(function(){0>a.indexOf(this.parentNode)&&a.push(this.parentNode)});return new _$(a)},closest:function(a){var c=[];this.each(function(){for(var b=this;b=b.parentNode;)if($(b).filter(a)[0])return 0>c.indexOf(b)&&c.push(b)});return new _$(c)},children:function(a){var c="string"==typeof a?a:"*",b=[];this.each(function(){for(var d=this.querySelectorAll(c),e=0;e<d.length;e++)d[e].parentNode==this&&(a instanceof _$?a.has(d[e]):1)&&b.push(d[e])});return new _$(b)},siblings:function(a){var c=
[],b=this;this.parent().children().filter(a).each(function(){!b.has(this)&&0>c.indexOf(this)&&c.push(this)});return new _$(c)},find:function(a){return new _$(a,this[0])},filter:function(a,c){a=$("<div>").append(this.clone(!0)).children(a);return new _$([].filter.call(this,function(b){for(var d=0;d<a.length;d++)if(a[d]._originalNode==b)return!c;return!!c}))},not:function(a){return this.filter(a,!0)},eq:function(a){return new _$(this[a])},has:function(a){for(var c=0;c<this.length;c++)if(this[c]._originalNode==
a||this[c]==a._originalNode||this[c]==a)return!0;return!1},add:function(a){a=_getEls(a);for(var c=[],b=0;b<this.length;b++)c.push(this[b]);a=c.concat([].filter.call(a,function(a){return-1==c.indexOf(a)}));return a.length==this.length?this:new _$(a)},attr:function(a,c){if(void 0===c)return this[0]&&this[0].getAttribute(a);this.each(function(){this[(null===c?"remove":"set")+"Attribute"](a,c)});return this},trigger:function(a,c){this.each(function(){var b=!$.browser.ie&&window.CustomEvent?new CustomEvent(a,
{detail:c}):document.createEvent("CustomEvent");!$.browser.ie&&window.CustomEvent||b.initCustomEvent(a,!1,!1,c);this.dispatchEvent(b)});return this},on:function(a,c){a=a.split(" ");this.each(function(){for(var b in a)this.addEventListener(a[b],c)});return this},off:function(a,c){a=a.split(" ");this.each(function(){for(var b in a)this.removeEventListener(a[b],c)});return this},click:function(a){if(a instanceof Function)this.on("click",a);else this.trigger("click");return this},text:function(a){if(void 0===
a)return this[0]&&this[0].textContent;this.each(function(){this.textContent=a});return this},html:function(a){if(void 0===a)return this[0]&&this[0].innerHTML;this.each(function(){this.innerHTML=a});return this},hasClass:function(a,c){c=0;this.each(function(){c+=this.classList.contains(a)&&1||0});return!!c},addClass:function(a){a=a.split(" ");this.each(function(){for(var c in a)a[c]&&this.classList.add(a[c])});return this},removeClass:function(a){a=a.split(" ");this.each(function(){for(var c in a)a[c]&&
this.classList.remove(a[c])});return this},toggleClass:function(a){a=a.split(" ");for(var c in a)if(a[c])this[(this.hasClass(a[c])?"remove":"add")+"Class"](a[c]);return this},setcss:function(a,c){this.each(function(){this.style.setProperty(a,c)});return this},getcss:function(a){return this[0]&&this[0].style.getPropertyValue(a)},css:function(a,c){if("string"==typeof a){if(void 0===c)return this.getcss(a);this.setcss(a,c)}else for(var b in a)this.setcss(b,a[b]);return this},hide:function(){this.setcss("display",
"none");return this},show:function(){this.setcss("display","block");return this},width:function(){return this[0]&&this[0].clientWidth},height:function(){return this[0]&&this[0].clientHeight}}}
$.browser=new function(){var a=navigator.userAgent.toLowerCase();this.webkit=/applewebkit/.test(a);this.firefox=/firefox/.test(a);this.safari=/safari/.test(a)&&!/chrome/.test(a);this.ie=/msie/.test(a)||/trident/.test(a);this.iemobile=/iemobile/.test(a);this.iOS=/ipad|iphone|ipod/.test(a);this.android=/android/.test(a);this.mobile=this.iOS||this.android||this.iemobile;this.unknown=!this.webkit&&!this.firefox&&!this.ie&&!this.iOS&&!this.android;this.version=parseFloat(this.webkit?a.match(/applewebkit\/(\d+)\./)[1]:
this.firefox?a.match(/firefox\/(\d+)\./)[1]:this.ie?a.match(/(msie\s|rv\:)(\d+)\./)[2]:-1);this.retina=window.devicePixelRatio&&2<=window.devicePixelRatio&&this.iOS;a=document.documentElement.classList;this.webkit&&a.add("webkit");this.firefox&&a.add("firefox");this.ie&&a.add("ie");this.iOS&&a.add("ios");this.android&&a.add("android");this.mobile&&a.add("mobile");c3p=(a=this.webkit||this.iOS)?"-webkit-":"";c3={perspective:c3p+"perspective",perspectiveOrigin:c3p+"perspective-origin",transform:c3p+
"transform",transition:c3p+"transition",transitionD:c3p+"transition-duration",transitionTF:c3p+"transition-timing-function",animation:c3p+"animation"};c3d={transform:(a?"webkitT":"t")+"ransform",transition:(a?"webkitT":"t")+"ransition",animation:(a?"webkitA":"a")+"animation"}};
$.events||($.events={getEvent:function(a){return a.changedTouches&&a.changedTouches[0]||a.touches&&a.touches[0]||a},getPageX:function(a){return $.events.getEvent(a).pageX},getPageY:function(a){return $.events.getEvent(a).pageY},getClientX:function(a){return $.events.getEvent(a).clientX},getClientY:function(a){return $.events.getEvent(a).clientY}});_Decor=function(){this.Scenes={};this.Things={};this._scenes={};this.init()};
_Decor.prototype={init:function(){(this.compatible=$.browser.webkit&&530<=$.browser.version||$.browser.firefox&&21<=$.browser.version||$.browser.ie&&10<=$.browser.version||$.browser.mobile)||incompatible();this.Frame=new _Decor._Frame;this.Audio=new _Decor._Audio},incompatible:function(){document.documentElement.classList.add("no-decor")},reloadScene:function(){this.resetTo(this.currentScene.name)()},reset:function(){var a=null,c;for(c in this.Scenes){a=c;break}this.resetTo(a)()},resetTo:function(a){var c=
this;return function(){c.currentScene&&c.currentScene.hide(function(){localStorage.removeItem("currentScene");c.currentScene=null;for(var b in c._scenes)c.delete(b);c.goto(a)()})}},resetHard:function(){localStorage.removeItem("currentScene");this.currentScene?this.currentScene.hide(function(){location.reload()}):location.reload()},goto:function(a,c){var b=this;return function(d){function e(){(b._scenes[a]||(b._scenes[a]=new Decor.Scene(a,g))).show()}if(b.compatible){var f=b.currentScene;if(!f||f.name!=
a){d&&d.target&&(d.stopPropagation(),d.preventDefault());var g=b.Scenes[a];if(!g)return console.error("Scene ["+a+"] not found");if(g.webkitOnly&&!$.browser.webkit||g.noIE&&$.browser.ie)return b.incompatible();if(f)f[c?"delete":"hide"](e);else e()}}}},delete:function(a){function c(){delete this._scenes[a]}this._scenes[a]&&(this._scenes[a].deleted?c():this._scenes[a].delete(c))}};_Decor._Frame=function(){this.started=!1;this._q=[];this._fi=this._raf=null};
_Decor._Frame.prototype={start:function(){if(!this.started){this.started=!0;var a=this;this._raf=requestAnimationFrame(this._cycle=function(){a.cycle()})}},stop:function(){this.started&&(this.started=!1,cancelAnimationFrame(this._raf))},cycle:function(a){if(!this._q.length)return this.stop();for(var c=this._q.length;c--;)this._q.shift()(a);this._raf=requestAnimationFrame(this._cycle)},request:function(a){1==this._q.push(a)&&this.start()},cancel:function(a){for(var c=0;c<this._q.length;c++)a==this._q[c]&&
this._q.shift();this._q.length||this.stop()}};_Decor._Audio=function(){this._f=[]};
_Decor._Audio.prototype={getSrc:function(a){($.browser.ie||$.browser.iOS||$.browser.safari)&&/\.ogg$/.test(a)&&(a=a.replace(/\.ogg/,".mp3"));return a},getIdle:function(a){for(var c in this._f)if(this._f[c].src==a&&!this._f[c].playing)return this._f[c]},play:function(a,c){a=this.getSrc(a);var b=this.getIdle(a);b?b.play.call(b):this._f.push(b=new Decor._Audio.Fragment(a,c));return b.audio},stop:function(a){a=this.getSrc(a);for(var c in this._f)this._f[c].src==a&&this._f[c].stop.call(this._f[c])}};
_Decor._Audio.Fragment=function(a,c){c=c||{};this.audio=new Audio;this.audio.volume=c.volume||1;this.audio.src=this.src=a;this.play()};_Decor._Audio.Fragment.prototype={playing:!1,play:function(){this.audio&&!this.playing&&(this.playing=!0,this.audio.load(),this.audio.play(),this.audio.addEventListener("ended",this.stop))},stop:function(){this.playing&&(this.playing=!1,this.audio.pause())}};Decor=new _Decor;
Decor.Scene=function(a,c){this.name=a;this.data=c=$.extend(!0,{},c);this._format=c.aspectRatio||16/9;this._res=c.res||[innerWidth,innerHeight*this._format];this._oImgNum=this._imgNum=0;this._rto=null;this._presx=0;this._checkFr=null;this.data.width=this.data.width||1;this.data.height=this.data.height||1;this.inited=!1;this.width=this._res[0];this.height=this._res[1];this.scale=1;this.perspective=0;this.objects=[];this.shown=!1;this.collisionObjects=[];this.margin=[0,0];this.camera=new Decor.Camera(this);
this.deleted=this.active=!1;this.init()};
Decor.Scene.prototype={init:function(){this.$=$("<scene>").addClass(this.name).css({width:this.width+"px",height:this.height+"px"}).appendTo(document.body);this.data.class&&this.$.addClass(this.data.class);this.data.fullWindow&&(this.data.fullWidth=this.data.fullHeight=!0);this.data.fullHeight&&this.$.addClass("full-height");this.data.scrolling&&(1<this.data.width&&(this.$hCanvas=$('<div class="canvas">').css("width",100*this.data.width+"%").appendTo(this.$)),1<this.data.height&&(this.$vCanvas=$('<div class="canvas vert">').appendTo(this.$)));
var a=this;this.addLoadImage=function(){this._imgNum++};this.imageLoaded=function(){--a._imgNum||a.loaded();if(a._oImgNum){var c=20*Math.round(5*((a._oImgNum-a._imgNum)/a._oImgNum));$(document.body).addClass("loaded-"+c)}}},load:function(){if(!this.inited){$(document.body).removeClass("done-loading");this.inited=!0;this.$[0].scrollLeft=0;this.resize();for(var a=0;a<this.data.objects.length;a++)this.addThing(this.data.objects[a],!0);var c=this;requestAnimationFrame(function(){if(c.data.oninit)c.data.oninit(c);
c._imgNum||c.loaded();c._oImgNum=c._imgNum})}},loaded:function(){this.data.scrollLeft&&this.camera.setPosition([10*(this.data.scrollLeft||0),0,0]);this.$.addClass("loaded");this.show()},getAttr:function(a){a=a||{};a.dims=a.dims||[1,1];a.pos=a.pos&&a.pos.length&&[a.pos[0]||0,a.pos[1]||0,a.pos[2]||0]||[0,0,0];a.rot=a.rot||[0,0,0];return a},updateViewable:function(){var a=this.margin,c=[this.$[0].scrollLeft,this.$[0].scrollTop],b=this.data.fullHeight&&innerHeight||this.height,a=[this.getCooFromPx(a[0]+
c[0],a[1]+c[1]),this.getCooFromPx(a[0]+c[0]+this.width,a[1]+c[1]+b)],a={l:a[0][0],t:-a[0][1],r:a[1][0],b:-a[1][1]},d;for(d in this.objects)this.objects[d].attr.showOnlyInView&&(c=this.objects[d].attr.showOnlyInView,c=this.objects[d].matrix.intersects({l:c[0][0],b:-c[0][1],r:c[1][0],t:-c[1][1]},a),this.objects[d].notInView==c&&this.objects[d].setNotInView(!c))},resize:function(){clearTimeout(this._rto);var a=this;this._rto=setTimeout(function(){a.postResize()},20);this.$.addClass("resizing");this._presx||
(this._presx=this.$[0].scrollLeft/this.$[0].scrollWidth);var c=[innerWidth,innerWidth/this._format];c[1]>innerHeight&&(c=[innerHeight*this._format,innerHeight]);var b={};this.data.fullWidth||(b["margin-left"]=(this.margin[0]=Math.round((innerWidth-c[0])/2))+"px");this.data.fullHeight||(b["margin-top"]=(this.margin[1]=Math.round((innerHeight-c[1])/2))+"px");this.data.fixedSize&&this.data.res?this.$.css(c3.transform,"scale("+(this.scale=c[0]/res[0])+")"):(b.width=(this.width=Math.round(this.data.fullWidth?
innerWidth:c[0]))+"px",b.height=(this.height=Math.round(c[1]))+"px",c=2*Math.round(Math.sqrt(Math.pow(this.width/2,2)+Math.pow(this.height/2,2))),b[c3.perspective]=(this.perspective=this.data.fixedPerspective||Math.max(this.data.minPerspective||0,c))+"px",this.data.perspectiveOrigin&&(b[c3.perspectiveOrigin]=[Math.round(this.data.perspectiveOrigin[0]*this.width),Math.round(this.data.perspectiveOrigin[1]*this.height)].join("px ")+"px"));this.$vCanvas&&this.$vCanvas.css("height",this.height*this.data.height+
"px");this.$.css(b).trigger("scene-resize")},postResize:function(){this.$.removeClass("resizing");this._presx&&(this.$[0].scrollLeft=this.camera.position[2]?0:Math.round(this._presx*this.$[0].scrollWidth));this._presx=0},getThing:function(a){for(var c in this.objects)if(this.objects[c].name==a)return this.objects[c]},getThings:function(a){return this.objects.filter(function(c){return c.name==a})},addThing:function(a,c){a.o=a.o||{};if(a.o.noIE&&$.browser.ie||a.o.noWebkit&&$.browser.webkit)return null;
var b,d,e;for(e in a){b=e;d=a[e];break}this.data.prototypes&&/^\$/.test(d)&&(d=d.substr(1),a.o=$.extend(a.o,this.data.prototypes[d],!0),d=d.toLowerCase());a.o.name&&(d=a.o.name);a.o.img&&this._imgNum++;e=Decor.Things[b];if(!e)return console.error("Object type "+b+" not found");b=new e(this,d,a.o=this.getAttr(a.o));b.name=d;b.attr=a.o;c||this.data.objects.push(a);this.sortThing(b);return b},sortThing:function(a,c){var b=this.objects.indexOf(a);0<=b&&this.objects.splice(b,1);var d=this.objects.length,
e;for(e in this.objects)if((a.attr.forceZOrder||a.attr.pos[2])<(this.objects[e].attr.forceZOrder||this.objects[e].attr.pos[2])){d=e;break}this.objects.splice(d,0,a);c&&(0<=b&&d!=b||0>b)&&this.placeThing(a);return d},placeThing:function(a){if(!a.$cnt)return console.warn("Trying to place thing without container");var c=this;requestAnimationFrame(function(){var b=c.objects.indexOf(a);if(0>b)return console.warn("Trying to place object not in scene");for(b+=1;b<c.objects.length;b++)if(c.objects[b].$cnt&&
c.objects[b].$cnt.parent()[0]==c.$[0]){a.$cnt.insertBefore(c.objects[b].$cnt);break}a.$cnt.parent()[0]!=c.$[0]&&a.$cnt.appendTo(c.$);a.placed=!0})},removeThing:function(a){var c=this.objects.indexOf(a);0<=c&&(this.objects.splice(c,1),a.remove&&a.remove())},getCooFromPx:function(a,c){var b=[(a-this.margin[0])/this.width,(c-this.margin[1])/this.height];return[b[0]+this.camera.position[0],1-b[1]+this.camera.position[1],this.camera.position[2]]},updateViewable:function(){if(this.data.checkInsideView){cancelAnimationFrame(this._checkFr);
var a=this;this._checkFr=requestAnimationFrame(function(){a.updateViewable()})}},show:function(){if(!this.shown){if(this.inited)this.resize();else return this.load();Decor.currentScene&&Decor.currentScene.hide();Decor.currentScene=this;localStorage.setItem("currentScene",name);this.$.show().addClass("placed");this.active=this.shown=!0;var a=this;addEventListener("resize",this._resize=function(){a.resize()});this.data.checkInsideView&&this.$[0].addEventListener("scroll",this._updateViewable=function(){a.updateViewable()});
onbeforeunload=function(){a.delete()};this.data.audio&&Decor.Audio.play(this.data.audio.src,this.data.audio);setTimeout(function(){a.$.addClass("shown");$(document.body).addClass("done-loading scene-shown").removeClass("loaded-"+[0,20,40,60,80,100].join(" loaded-"));a.$.trigger("scene-show",a.name);if(a.data.onshow)a.data.onshow(a)})}},hide:function(a,c){if(!this.shown)return a&&a();this.active=this.shown=!1;this.$[0].removeEventListener("scroll",this._updateViewable);removeEventListener("resize",
this._resize);this.$.removeClass("shown").addClass("hiding");$(document.body).removeClass("scene-shown");this.data.audio&&Decor.Audio.stop(this.data.audio.src);setTimeout(function(b){b.$.removeClass("placed hiding").hide();$(window).add(b.$).trigger("scene-hide",b.name);a&&a()},data.hideDuration||0,this)},delete:function(a){function c(a){for(var c in b.objects)b.objects[c].remove&&b.objects[c].remove();b.$.remove();delete b.$;b.deleted=!0;a&&a()}var b=this;b.shown?b.hide(function(){c(a)}):c(a)}};
Decor.Camera=function(a){this._oY=a.data.height-1;this._limit=a.data.limitCamera;this._aniTo=null;this._ppos="0,0,0";this._startPos=a.data.cameraPosition;this.scene=a;this.offset=[0,this._oY,0];this.position=[0,0,0];this.init()};
Decor.Camera.prototype={init:function(){this._startPos&&setTimeout(function(a){2==a._startPos.length&&a._startPos.push(0);a.setPosition(a._startPos)},0,this)},panTo:function(a,c,b,d){if(a instanceof Array){clearTimeout(this._aniTo);if(c){var e={};e[c3.transitionTF]=b||"ease-in-out";e[c3.transitionD]=(c||0)/1E3+"s";this.insideView(function(){this.$cnt.css(e)});var f=this;this._aniTo=setTimeout(function(){f.resetAnimation()},c+50)}else this.resetAnimation();this.setPosition(a,d)}},setPosition:function(a,
c){var b=a+"";if(this._ppos!=b){this._ppos=b;this.position[0]=this._limit?Math.min(this.scene.data.width,Math.max(-1,a[0])):a[0];this.position[1]=this._limit?Math.min(this._oY,Math.max(0,a[1])):a[1];this.position[2]=a[2];this.scene.updateViewable();var d=this;requestAnimationFrame(function(){d.insideView(function(){this.place(c)})})}},reset:function(a){this.panTo([0,0,0],a,null,!0)},resetZ:function(a){this.panTo([this.position[0],this.position[1],0],a,null,!0)},resetAnimation:function(){var a={};
a[c3.transitionTF]="";a[c3.transitionD]="";this.insideView(function(){this.$cnt.css(a)})},insideView:function(a){if(!(!a instanceof Function))for(var c in this.scene.objects){var b=this.scene.objects[c];b.matrix&&(b.attr.main||a.call(b))}}};Decor.Object3D=function(a,c,b){this.scene=a;this.$el=c;this._o=b;this.matrix=new Decor.Mat3D(this,b.pos,b.rot,b.scale);this.notInView=!1;this._init()};
Decor.Object3D.prototype={_init:function(){this.place();this.scene.$.on("scene-resize",this.place)},reset:function(){this.matrix.translate(null,!0);return this},setPosition:function(a){this._o.pos[0]=a[0];this._o.pos[1]=a[1];this._o.pos[2]!=a[2]&&(this._o.pos[2]=a[2],this.scene.sortThing(this,this.$cnt&&this.$cnt.parent()[0]==this.scene.$[0]));this.reset().place()},translate:function(a,c){this.matrix.translate(a);this.place();return this},setNotInView:function(a){this.notInView!=a&&((this.notInView=
a)?this.$el.hide():this.$el.show())},place:function(a){this.$el&&(this.$el[0].style[c3d.transform]=this.matrix.getCSS(a))},focus:function(a){var c="zoom-out";if(this.$el.toggleClass("open").hasClass("open")){c="zoom-in";this.scene.$.find(".open").not(this.$el).removeClass("open");var b=this.matrix.getPosition(),d=this.$.width(),e=this.$.height();e>this.scene.height?b[2]-=this.scene.height-1.05*e:d>this.scene.width&&(b[2]-=(this.scene.width-d)/2);b[0]-=(1-(this._o.width||0))/2;b[1]*=-1;b[2]*=-1;a instanceof
Array&&(b[0]+=a[0],b[1]+=a[1],a[2]&&(b[2]+=a[2]));this.scene.currentFocus=this;this.scene.camera.panTo(b,this.scene.data.focusDuration||0)}else this.scene.currentFocus=null,this.scene.camera.reset(this.scene.data.focusDuration||0);this.scene.$.trigger(c,this.name)}};Decor.Mat3D=function(a,c,b,d){this.thing=a;this.scene=a.scene;this._xyz=c||[0,0,0];this._rot=b||[0,0,0];this._scale=this.getScale(d);this._rel=[0,0,0]};
Decor.Mat3D.prototype={getScale:function(a){a=a?a.length?a:[a||1,a||1,1]:[1,1,1];2==a.length&&a.push(1);return a},getQuad:function(a){a=a||[0,0,0];var c=this.getPosition(),b=[this.thing.rwidth,this.thing.rheight];return{l:c[0]+a[0],r:c[0]+a[0]+b[0],t:-(c[1]-a[1]),b:-(c[1]-a[1]-b[1])}},intersects:function(a,c){var b=c&&"l"in c&&c||this.getQuad();return!(a.l>b.r||a.r<b.l||a.t>b.b||a.b<b.t)},translate:function(a,c){c&&(this._rel=[0,0,0]);a&&(this._rel[0]+=a[0],this._rel[1]+=a[1],this._rel[2]+=a[2]);
return me},getCSS:function(a){var c=this.scene.camera.offset,b=this.scene.camera.position,d=this.thing.attr.relative?0:b[0],e=this.thing.attr.relative?0:c[1]-(this.scene.data.height-1)-b[1],f=this.thing.container||this.scene,g=[f.width,f.height],f=[],k=this.scene.data.depthFactor||1;a||(d-=this.scene.$[0].scrollLeft/this.scene.width);a=[Math.round(g[0]*(this._xyz[0]+this._rel[0]+c[0]-d)),-Math.round(g[1]*(this._xyz[1]+this._rel[1]+e)),k*(this._xyz[2]+this._rel[2]+b[2])+c[2]];this.scene.data.fullHeight&&
(a[1]+=Math.round(Math.min(0,innerWidth/this.scene.data.aspectRatio-innerHeight)));f.push("translate3d("+a.join("px,")+"px)");this._rot[0]&&f.push("rotateX("+this._rot[0]+"deg)");this._rot[1]&&f.push("rotateY("+this._rot[1]+"deg)");this._rot[2]&&f.push("rotateZ("+this._rot[2]+"deg)");1==this._scale[0]&&1==this._scale[1]&&1==this._scale[2]||f.push("scale3d("+this._scale.join(",")+")");return f.join(" ")},getPosition:function(){return[this._xyz[0]+this._rel[0],this._xyz[1]+this._rel[1],this._xyz[2]+
this._rel[2]]},getElementPosition:function(){var a=this.getPosition(),c=getComputedStyle(this.thing.$[0])[c3.transform];/^matrix\(/.test(c)&&(c=c.substr(0,c.length-1).split(","),a[0]+=parseFloat(c[4])/this.scene.width,a[1]+=parseFloat(c[5])/this.scene.height);return a},getX:function(){return this._xyz[0]+this._rel[0]},getY:function(){return this._xyz[1]+this._rel[1]},getZ:function(){return this._xyz[2]+this._rel[2]},get xyz(){return this.xyz},set xyz(a){this._xyz=a},get rot(){return this.rot},set rot(a){this._rot=
a},get scale(){return this.scale},set scale(a){this._scale=this.getScale(a)}};Decor.Things.Thing=function(a,c,b){this.name=c;this.attr=b;this.scene=a;this.$cnt=$('<thing class="thing">');this.init?this.init():console.warn("oei!",this,c,b)};
Decor.Things.Thing.prototype=Object.create(Decor.Object3D.prototype,{init:{value:function(){this.$=this.attr.static?this.$cnt:$("<thing>").appendTo(this.$cnt);this.$[0].thing=this.$cnt[0].thing=this;this.attr.static&&this.$cnt.addClass("static");this.$.addClass(this.name+(this.attr.class?" "+this.attr.class:""));this.$cnt.addClass(this.name+"-cnt");this.attr.clickable&&this.$cnt.addClass("clickable");this.attr.textContent&&this.$.text(this.attr.textContent);Decor.Object3D.call(this,this.scene,this.$cnt,
this.attr);var a=this;this.scene.$.on("scene-resize",function(){a.setDims()});this.setDims();this.attr.noshow||this.show()}},setDims:{value:function(a){if(a&&a.length)for(var c in a)o.dims[c]=a[c];a=this.attr.isDepth?this.scene.height/1080:1;c=this.attr.relativeSize&&this.container||this.scene;this.$.css({width:(this.width=this.attr.px&&this.attr.px[0]||Math.round(this.attr.dims[0]*c.width))+"px",height:(this.height=this.attr.px&&this.attr.px[1]||Math.round(this.attr.dims[1]/a*c.height))+"px"});this.rwidth=
this.attr.px?this.attr.px[0]/this.scene.width:this.attr.dims[0];this.rheight=this.attr.px?this.attr.px[1]/this.scene.height:this.attr.dims[1]}},show:{value:function(){this.placed?this.$cnt.show():this.scene.placeThing(this)}},hide:{value:function(){this.$cnt.hide()}},remove:{value:function(){this.$cnt.remove();this.placed=!1}}});Decor.Things.Static=function(a,c,b){b.static=!0;Decor.Things.Thing.call(this,a,c,b)};Decor.Things.Static.prototype=Object.create(Decor.Things.Thing.prototype);
Decor.Things.Container=function(a,c,b){Decor.Things.Thing.call(this,a,c,b);this.children=[];for(c=0;c<b.children.length;c++){b.children[c].o.noshow=!0;b.children[c].o.relativeSize=b.relativeSize;var d=a.addThing(b.children[c]);d.container=this;this.$.append(d.$cnt);this.children.push(d)}};Decor.Things.Container.prototype=Object.create(Decor.Things.Thing.prototype);
Decor.Things.HTMLContain=function(a,c,b){function d(){e.$cnt.css("font-size",b.relativeFontSize*a.height+"px")}var e=this;Decor.Things.Static.call(this,a,c,b);$("body>"+b.selector+",body>*:not(scene) "+b.selector).hide().clone().show().appendTo(this.$cnt);b.watch&&(e.$cnt.addClass("hidden"),a.$.on("zoom-in zoom-out",function(a){"zoom-in"==a.type&&a.detail==b.watch?e.$cnt.removeClass("hidden"):e.$cnt.addClass("hidden")}));b.relativeFontSize&&(a.$.on("scene-show scene-resize",d),a.shown&&d())};
Decor.Things.HTMLContain.prototype=Object.create(Decor.Things.Static.prototype);
Decor.Things.ImageContain=function(a,c,b){function d(){var a=k.offsetHeight*g.width()/k.offsetWidth,b=Math.round(a*h[0][1]);m.css({height:a-b,bottom:b})}b.width&&(b.dims=[b.width,0]);var e=this,f=b.px?b.px[0]+"px":100*b.dims[0]+"%",g=$("<"+(b.tagName||"thing")+' class="thing">').css("width",f);this.scene=a;var k=null,k=new Image;k.thing=e;k.onload=function(h){b.dims[1]=b.dims[0]*k.height/k.width;e.rwidth=b.dims[0];e.rheight=b.dims[1];l&&d();e.$.addClass("image "+c);b.static&&(e.$.css("width",f),e.$cnt.replaceWith(e.$),
e.$cnt=g=e.$);g.addClass(c+"-cnt");b.clickable&&g.addClass("clickable");b.class&&g.addClass(b.class);Decor.Object3D.call(e,a,g,b);b.clickable&&b.clickToFocus&&(l?m:e.$).click(e.focus);b.static||e.$.appendTo(e.$cnt);if(e.onload)e.onload();a.imageLoaded(c)};k.onerror=a.imageLoaded;k.src=b.img;e.$=$(k).addClass("thing");e.$cnt=g;g[0].thing=this;var m=$(),l=b.clickable&&b.clickable.length;$.browser.ie&&11>$.browser.version&&(l=!1);var h=b.clickable&&b.clickable.length?b.clickable:[[0,0],[1,1]];b.clickable&&
l&&(g.addClass("has-area"),m=$('<div class="click-area">').css({left:100*h[0][0]+"%",width:100*(h[1][0]-h[0][0])+"%"}).appendTo(g));if(l)a.$.on("scene-resize",d);this.show=function(){e.placed?g.show():a.placeThing(e)};this.hide=function(){g.hide()};this.remove=function(){g.remove();e.placed=!1};b.noshow||this.show()};Decor.Things.ImageContain.prototype=Object.create(Decor.Object3D.prototype);Decor.Things.Image=function(a,c,b){b.static=!0;Decor.Things.ImageContain.call(this,a,c,b)};
Decor.Things.Image.prototype=Object.create(Decor.Things.ImageContain.prototype);Decor.Things.ImageLink=function(a,c,b){b.tagName="a";Decor.Things.ImageContain.call(this,a,c,b);this.$cnt[0].href=b.href;b.external&&(this.$cnt[0].target="_blank");b.title&&(this.$cnt[0].title=b.title)};Decor.Things.ImageLink.prototype=Object.create(Decor.Things.ImageContain.prototype);
Decor.Things.ImageBG=function(a,c,b){var d=this;b.class="imagebg "+(b.class||"");Decor.Things.Static.call(this,a,c,b);if(b.width){b.dims[0]=b.width;b.dims[1]=0;var e=new Image;e.onload=function(){b.dims[1]=b.dims[0]*e.height/e.width/(a.height/a.width);d.setDims();a.imageLoaded()};e.src=b.img}else a.imageLoaded();this.$.css("background-image","url("+b.img+")")};Decor.Things.ImageBG.prototype=Object.create(Decor.Things.Static.prototype);
Decor.Things.ImageRep=function(a,c,b){a.imageLoaded();for(var d=0;d<b.repeat;d++)a.addThing({Image:c,o:$.extend(b,{img:b.img,width:b.width,pos:[b.pos[0]+d*b.width,b.pos[1],b.pos[2]]})})};Decor.Things.ThingRep=function(a,c,b){for(var d=0;d<b.repeat;d++)a.addThing({Thing:c,o:$.extend(b,{dims:b.dims,px:b.px,pos:[b.pos[0]+d*b.trans[0],b.pos[1]+d*b.trans[1],b.pos[2]-d*b.trans[2]]})})};
Decor.Things.Cube=function(a,c,b){function d(){var c=Math.sqrt(Math.pow(a.width/2,2)+Math.pow(a.height/2,2))*b.dims[2];e.$.children(".side:not(.front)").each(function(){var a=$(this);"back"==this.sideType?a.css(c3.transform,"rotateY(180deg) translate3d(0,0,"+c+"px"):a.css("bottom"==this.sideType||"top"==this.sideType?"height":"width",c+"px")})}var e=this,f={back:1,bottom:1,top:1,right:1,left:1,front:1};if(b.sides)for(var g in b.sides)f[g]=b.sides[g];b.dims[2]=b.dims[2]||b.dims[0];b.class=(b.class||
"")+" cube";Decor.Things.Thing.call(this,a,c,b);this.$cnt.add(this.$).addClass("preserve-3d");for(g in f)f[g]&&($('<div class="side '+g+'">').appendTo(this.$)[0].sideType=g);a.$.on("scene-resize",d);setTimeout(d)};Decor.Things.Cube.prototype=Object.create(Decor.Things.Thing.prototype);
Decor.Things.Overlay=function(a,c,b){function d(){var c={left:a.$[0].offsetLeft+Math.round(a.width*b.pos[0])+"px",top:a.$[0].offsetTop+Math.round(a.height*b.pos[1])+"px"};if(0<b.dims[0]||b.px&&0<b.px[0])c.width=b.px?b.px[0]:Math.round(a.width*b.dims[0])+"px";if(0<b.dims[1]||b.px&&0<b.px[1])c.height=b.px?b.px[1]:Math.round(a.height*b.dims[1])+"px";e.$cnt.css(c)}var e=this,f=$("body>"+b.selector+",body>*:not(scene) "+b.selector).hide().clone().show();this.$cnt=$('<div class="overlay '+c+(b.class?" "+
b.class:"")+'">');this.$=(f[0]?f:$("<div>")).appendTo(this.$cnt);this.show=function(){e.$cnt[0].parentNode!=document.body?e.$cnt.appendTo(document.body):e.$cnt.show()};this.hide=function(){e.$cnt.hide()};this.remove=function(){e.$cnt.remove()};a.$.on("scene-show scene-resize",d);a.shown&&d();b.noshow||this.show()};
