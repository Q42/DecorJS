// DecorJS - v0.4 | https://github.com/Q42/DecorJS | (c) 2014 Q42, Marcel Duin <marcel@q42.nl> | MIT Licensed, https://github.com/Q42/DecorJS/blob/master/LICENSE
if(!window.$){$=function(a){return new _$(a)};$.extend=function(){function a(c,d){for(var e in c){var f=c[e],l=f&&f.constructor;d[e]=b&&l&&(l==Array||l==Object)?a(f,new l):b&&l&&(l==Number||l==String)?l(f):f}return d}for(var c=arguments,b=!0===c[0],d=c[b&&1||0],f=b?2:1;f<c.length;f++)a(c[f],d);return d};var _getEls=function(a,c){if(a==window)return[window];if(a instanceof Element)return[a];if(a instanceof Array||a instanceof _$)return a;if(/^\</.test(a)){var b=document.createElement("div");b.innerHTML=
a;return b.childNodes}return a?(c||document).querySelectorAll(a):[]},_$=function(a,c){var b=_getEls(a,c),d;for(d in b)this[d]=b[d];this.length||(this.length=b.length)};_$.prototype={each:function(a){for(var c=0;c<this.length;c++)a.call(this[c]);return this},remove:function(){this.each(function(){this.parentNode.removeChild(this)});return this},replaceWith:function(a){var c=this;c[0]&&(a.each?a.each(function(){c[0].parentNode.insertBefore(this,c[0])}):c[0].parentNode.insertBefore(a,c[0]),c.remove());
return this},appendTo:function(a){a=a.length?a[0]:a;this.each(function(){a.appendChild(this)});return this},parent:function(){var a=[];this.each(function(){0>a.indexOf(this.parentNode)&&a.push(this.parentNode)});return new _$(a)},children:function(a){a=a||"*";var c=[];this.each(function(){for(var b=this.querySelectorAll(a),d=0;d<b.length;d++)b[d].parentNode==this&&c.push(b[d])});return new _$(c)},find:function(a){return new _$(a,this[0])},filter:function(a,c){a=_getEls(a);return new _$([].filter.call(this,
function(b){for(var d=0;d<a.length;d++)if(a[d]==b)return!c;return!!c}))},not:function(a){return this.filter(a,!0)},eq:function(a){return new _$(this[a])},has:function(a){for(var c=0;c<this.length;c++)if(this[c]==a)return!0},add:function(a){a=_getEls(a);for(var c=[],b=0;b<this.length;b++)c.push(this[b]);a=c.concat([].filter.call(a,function(b){return-1==c.indexOf(b)}));return a.length==this.length?this:new _$(a)},attr:function(a,c){if(void 0===c)return this[0]&&this[0].getAttribute(a);this.each(function(){this[(null===
c?"remove":"set")+"Attribute"](a,c)});return this},trigger:function(a,c){this.each(function(){var b=isIE?document.createEvent("CustomEvent"):new CustomEvent(a,{detail:c});isIE&&b.initCustomEvent(a,!1,!1,c);this.dispatchEvent(b)});return this},on:function(a,c){a=a.split(" ");this.each(function(){for(var b in a)this.addEventListener(a[b],c)});return this},off:function(a,c){a=a.split(" ");this.each(function(){for(var b in a)this.removeEventListener(a[b],c)});return this},click:function(a){if(a instanceof
Function)this.on("click",a);else this.trigger("click");return this},text:function(a){if(void 0===a)return this[0]&&this[0].textContent;this.each(function(){this.textContent=a});return this},html:function(a){if(void 0===t)return this[0]&&this[0].innerHTML;this.each(function(){this.innerHTML=a});return this},hasClass:function(a,c){c=0;this.each(function(){c+=this.classList.contains(a)&&1||0});return!!c},addClass:function(a){a=a.split(" ");this.each(function(){for(var c in a)this.classList.add(a[c])});
return this},removeClass:function(a){a=a.split(" ");this.each(function(){for(var c in a)this.classList.remove(a[c])});return this},toggleClass:function(a){a=a.split(" ");for(var c in a)this[(this.hasClass(a[c])?"remove":"add")+"Class"](a[c]);return this},setcss:function(a,c){this.each(function(){this.style.setProperty(a,c)});return this},getcss:function(a){return this[0]&&this[0].style.getPropertyValue(a)},css:function(a,c){if("string"==typeof a){if(void 0===c)return this.getcss(a);this.setcss(a,
c)}else for(var b in a)this.setcss(b,a[b]);return this},hide:function(){this.setcss("display","none");return this},show:function(){this.setcss("display","block");return this},width:function(){return this[0]&&this[0].clientWidth},height:function(){return this[0]&&this[0].clientHeight}}}
Decor=new function(){var a=this,c=navigator.userAgent.toLowerCase();isWebkit=/chrome/.test(c);isFirefox=/firefox/.test(c);isIE=/msie/.test(c)||/trident/.test(c);isIOS=/ipad|iphone|ipod/.test(c);isAndroid=/android/.test(c);isMobile=isIOS||isAndroid;c=document.firstChild.classList;isWebkit&&c.add("webkit");isFirefox&&c.add("firefox");isIE&&c.add("ie");isIOS&&c.add("ios");isAndroid&&c.add("android");isMobile&&c.add("mobile");c3p=isWebkit||isIOS?"-webkit-":"";c3={transform:c3p+"transform",transition:c3p+
"transition",animation:c3p+"animation"};c3d={transform:(isWebkit||isIOS?"webkitT":"t")+"ransform",transition:(isWebkit||isIOS?"webkitT":"t")+"ransition",animation:(isWebkit||isIOS?"webkitA":"a")+"animation"};$window=$(window);var b={};this.Scenes={};this.Things={};this.reloadScene=function(){a.resetTo(Decor.currentScene.name)()};this.reset=function(){var b=null,c;for(c in Decor.Scenes){b=c;break}a.resetTo(b)()};this.resetTo=function(c){return function(){Decor.currentScene&&Decor.currentScene.hide(function(){localStorage.removeItem("currentScene");
Decor.currentScene=null;for(var f in b)a.delete(f);a.goto(c)()})}};this.resetHard=function(){localStorage.removeItem("currentScene");Decor.currentScene?Decor.currentScene.hide(function(){location.reload()}):location.reload()};this.goto=function(a){return function(c){function g(){(b[a]||(b[a]=new Decor.Scene(a,e))).show()}var h=Decor.currentScene;if(!h||h.name!=a){c&&c.target&&(c.stopPropagation(),c.preventDefault());var e=Decor.Scenes[a];if(!e)return console.error("Scene ["+a+"] not found");h?h.hide(g):
g()}}};this.delete=function(a){function c(){delete b[a]}b[a]&&(b[a].deleted?c():b[a].delete(c))}};
Decor.Scene=function(a,c){function b(){if(!p){$(document.body).removeClass("done-loading");p=!0;e.$[0].scrollLeft=0;f();for(var b=0;b<c.objects.length;b++){var a=c.objects[b];a.o=a.o||{};if(!a.o.noIE||!isIE){var g,l,h;for(h in a){g=h;l=a[h];break}c.prototypes&&/^\$/.test(l)&&(l=l.substr(1),a.o=$.extend(a.o,c.prototypes[l]),l=l.toLowerCase());a.o.img&&q++;var n=Decor.Things[g];if(n){var k=e,m=l,a=(a=a.o)||{};a.dims=a.dims||[1,1];a.pos=a.pos||[0,0,0];a.rot=a.rot||[0,0,0];a=new n(k,m,a);a.name=l;e.objects.push(a)}else console.error("Object type "+
g+" not found")}}if(c.oninit)c.oninit(e);q||d();r=q}}function d(){c.scrollLeft&&e.camera.setPosition([10*(c.scrollLeft||0),0,0]);e.$.addClass("loaded");e.show()}function f(){clearTimeout(s);s=setTimeout(g,20);e.$.addClass("resizing");m||(m=e.$[0].scrollLeft/e.$[0].scrollWidth);var a=[innerWidth,innerWidth/k];a[1]>innerHeight&&(a=[innerHeight*k,innerHeight]);var b={"margin-left":e.margin[0]=c.fullWidth?0:Math.round((innerWidth-a[0])/2),"margin-top":e.margin[1]=Math.round((innerHeight-a[1])/2)};c.fixedSize&&
c.res?e.$.css(c3.transform,"scale("+(e.scale=a[0]/l[0])+")"):(e.width=Math.round(a[0]),b.width=c.fullWidth?innerWidth:e.width,b.height=e.height=Math.round(a[1]));e.$.css(b).trigger("scene-resize")}function g(){e.$.removeClass("resizing");m&&(e.$[0].scrollLeft=e.camera.position[2]?0:Math.round(m*e.$[0].scrollWidth));m=0}function h(a){for(var b in e.objects)e.objects[b].destroy&&e.objects[b].destroy();e.$.remove();delete e.$;e.deleted=!0;a&&a()}c=$.extend(!0,{},c);var e=this,k=16/9,l=c.res||[innerWidth,
innerHeight*k],n=!1,p=!1,q=0,r=0,m=0,s=null;c.width=c.width||1;c.height=c.height||1;this.name=a;this.data=c;this.width=l[0];this.height=l[1];this.scale=1;this.objects=[];this.collisionObjects=[];this.margin=[0,0];this.camera=new Decor.Camera(this);this.deleted=this.active=!1;this.$=$("<scene>").addClass(a).css({width:l[0],height:l[1]}).appendTo(document.body);c.scrolling&&1<c.width&&$('<div class="canvas">').css("width",100*c.width+"%").appendTo(this.$);this.imageLoaded=function(){--q||d();if(r){var a=
20*Math.round(5*((r-q)/r));$(document.body).addClass("loaded-"+a)}};this.addLoadImage=function(){q++;r++};this.getThing=function(a){for(var b in e.objects)if(e.objects[b].name==a)return e.objects[b]};this.show=function(){if(!n){if(p)f();else return b();Decor.currentScene&&Decor.delete(Decor.currentScene.name);Decor.currentScene=this;localStorage.setItem("currentScene",a);e.$.addClass("placed");n=!0;e.active=!0;addEventListener("resize",f);c.audio&&Decor.Audio.play(c.audio.src,c.audio);e.$.trigger("scene-show",
a);onbeforeunload=function(){e.delete(null,0)};setTimeout(function(){e.$.addClass("shown");$(document.body).addClass("done-loading scene-shown").removeClass("loaded-"+[0,20,40,60,80,100].join(" loaded-"))})}};this.hide=function(b,d){if(!n)return b&&b();n=!1;e.active=!1;e.$.removeClass("shown");$(document.body).removeClass("scene-shown");$window.add(e.$).trigger("scene-hide",a);removeEventListener("resize",f);c.audio&&Decor.Audio.stop(c.audio.src);setTimeout(function(){e.$.removeClass("placed");b&&
b()},isNaN(d)?1E3:d)};this.delete=function(a,b){n?e.hide(function(){h(a)},b):h(a)}};
Decor.Camera=function(a){function c(c){var d={l:b.position[0]-1,r:b.position[0]+2,t:b.position[1]-0.5,b:b.position[1]+1},e;for(e in a.objects){var f=a.objects[e];f.matrix&&(f.attr.main||(a.data.renderAll||f.matrix.intersects(d))&&c&&c.call(f))}}var b=this,d=a.data.height-1,f="0,0,0";this.offset=[0,d,0];this.position=[0,0,0];this.setPosition=function(g,h){var e=g+"";f!=e&&(f=e,b.position[0]=Math.min(a.data.width,Math.max(0,g[0])),b.position[1]=Math.min(d,Math.max(0,g[1])),b.position[2]=g[2],c(function(){this.place(h)}))};
this.reset=function(){b.setPosition([0,0,0],!0)};this.resetZ=function(){b.setPosition([b.position[0],b.position[1],0],!0)}};
Decor.Object3D=function(a,c,b){var d=this,f=null;this.matrix=new Decor.Mat3D(this,b.pos,b.rot,b.scale);this.notInView=!1;this.reset=function(){d.matrix.translate(null,!0);return d};this.setPosition=function(a){b.pos[0]=a[0];b.pos[1]=-a[1];b.pos[2]=a[2];d.reset().place()};this.translate=function(a,b){d.matrix.translate(a);d.place();return d};this.setNotInView=function(a){d.notInView!=a&&((d.notInView=a)?c.hide():c.show())};this.place=function(a){c[0].style[c3d.transform]=d.matrix.getCSS(a)};this.focus=
function(){if(a.dimmed&&c.hasClass("open"))return $(".nav.back").click();clearTimeout(f);a.$.addClass("animate");var g="zoom-out";if(c.toggleClass("open").hasClass("open")){g="zoom-in";a.$.find(".open").not(c).removeClass("open");var h=d.matrix.getPosition(),e=d.$.width(),k=d.$.height();k>a.height?h[2]-=a.height-1.05*k:e>a.width&&(h[2]-=(a.width-e)/2);h[0]-=(1-b.width)/2;h[2]*=-1;a.camera.setPosition(h)}else a.camera.resetZ();a.$.trigger(g,d.name);f=setTimeout(function(){a.$.removeClass("animate")},
500)};this.place();a.$.on("scene-resize",d.place)};
Decor.Mat3D=function(a,c,b,d){c=c||[0,0,0];b=b||[0,0,0];d=d?d.length?d:[d||1,d||1,1]:[1,1,1];2==d.length&&d.push(1);var f=this,g=a.scene,h=g.camera.position,e=[0,0,0],k=[a.rwidth,a.rheight];this.getQuad=function(a){a=a||[0,0,0];var b=f.getPosition();return{l:b[0]+a[0],r:b[0]+a[0]+k[0],t:-(b[1]-a[1]),b:-(b[1]-a[1]-k[1])}};this.intersects=function(a){var b=f.getQuad();return!(a.l>b.r||a.r<b.l||a.t>b.b||a.b<b.t)};this.getCSS=function(f){var k=a.scene.camera.offset,p=a.attr.relative?0:h[0],q=a.attr.relative?
0:k[1]-(g.data.height-1)-h[1],r=[g.width,g.height],m=[];f||(p-=g.$[0].scrollLeft/g.width);f=[Math.round(r[0]*(c[0]+e[0]+k[0]-p)),-Math.round(r[1]*(c[1]+e[1]+q)),Math.round(0.3*(c[2]+e[2]+h[2]))+k[2]];m.push("translate3d("+f.join("px,")+"px)");b[0]&&m.push("rotateX("+b[0]+"deg)");b[1]&&m.push("rotateY("+b[1]+"deg)");b[2]&&m.push("rotateZ("+b[2]+"deg)");1==d[0]&&1==d[1]&&1==d[2]||m.push("scale3d("+d.join(",")+")");return m.join(" ")};this.getPosition=function(a){return[c[0]+e[0],-(c[1]+e[1]),c[2]+e[2]]};
this.getElementPosition=function(){var b=f.getPosition(),c=getComputedStyle(a.$[0])[c3.transform];/^matrix\(/.test(c)&&(c=c.substr(0,c.length-1).split(","),b[0]+=parseFloat(c[4])/g.width,b[1]+=parseFloat(c[5])/g.height);return b};this.getX=function(){return c[0]+e[0]};this.getY=function(){return c[1]+e[1]};this.getZ=function(){return c[2]+e[2]+h[2]};this.translate=function(a,b){b&&(e=[0,0,0]);a&&(e[0]+=a[0],e[1]+=a[1],e[2]+=a[2]);return f}};
Decor.Frame=new function(){function a(f){if(c.length){for(var g=0;g<c.length;g++)c.shift()(f);d=requestAnimationFrame(a)}else b&&(b=!1,cancelAnimationFrame(d))}var c=[],b=!1,d=null;this.request=function(f){1==c.push(f)&&(b||(b=!0,d=requestAnimationFrame(a)))};this.cancel=function(a){for(var g=0;g<c.length;g++)a==c[g]&&c.shift();!c.length&&b&&(b=!1,cancelAnimationFrame(d))}};
Decor.Audio=new function(){function a(a,b){b=b||{};this.audio=new Audio;this.audio.volume=b.volume||1;this.audio.src=this.src=a;this.play()}function c(a){(isIE||isIOS)&&/\.ogg$/.test(a)&&(a=a.replace(/\.ogg/,".mp3"));return a}var b=[];a.prototype={playing:!1,play:function(){this.audio&&!this.playing&&(this.playing=!0,this.audio.load(),this.audio.play(),this.audio.addEventListener("ended",this.stop))},stop:function(){this.playing&&(this.playing=!1,this.audio.pause())}};this.play=function(d,f){d=c(d);
var g;a:{for(g in b)if(b[g].src==d&&!b[g].playing){g=b[g];break a}g=void 0}g?g.play.call(g):b.push(g=new a(d,f));return g.audio};this.stop=function(a){a=c(a);for(var f in b)b[f].src==a&&b[f].stop.call(b[f])}};
Decor.Things.Thing=function(a,c,b){function d(){var c=b.isDepth?a.height/1080:1;f.$.css({width:f.width=b.px&&b.px[0]||Math.round(b.dims[0]*a.width),height:f.height=b.px&&b.px[1]||100*(b.dims[1]/c)+"%"});f.rwidth=b.px?b.px[0]/a.width:b.dims[0];f.rheight=b.px?b.px[1]/a.height:b.dims[1]}var f=this;this.attr=b;this.scene=a;var g=$(b.static?"<thing>":'<dud class="dud">');g[0].thing=this;this.$cnt=g;c&&g.addClass(c+(b.static?" static":"")+(b.class?" "+b.class:""));this.$=b.static?g:$("<thing>").appendTo(g);
b.innerText&&this.$.text(b.innerText);a.$.on("scene-resize",d);d();this.show=function(){g.appendTo(a.$)};this.hide=function(){g.remove()};this.destroy=function(){g.remove()};Decor.Object3D.call(this,a,g,b);b.noshow||this.show()};Decor.Things.Static=function(a,c,b){b.static=!0;Decor.Things.Thing.call(this,a,c,b)};
Decor.Things.HTMLContain=function(a,c,b){var d=this;Decor.Things.Static.call(this,a,c,b);$(b.selector).appendTo(this.$cnt);b.watch&&(d.$cnt.addClass("hidden"),a.$.on("zoom-in zoom-out",function(a){"zoom-in"==a.type&&a.detail==b.watch?d.$cnt.removeClass("hidden"):d.$cnt.addClass("hidden")}));a.$.on("scene-show scene-resize",function(){var b=Math.max(8,16/1080*a.height);d.$cnt.css("font-size",b+"px")})};
Decor.Things.ImageContain=function(a,c,b){function d(){var a=k.height*e.width()/k.width,b=Math.round(a*p[0][1]);l.css({height:a-b,bottom:b})}b.width=b.width||1;b.dims=[b.width,0];var f=this,g=/\..{3}$/.test(b.img)?"":".png",g="img/"+b.img+g,h=b.px?b.px[0]:100*b.dims[0]+"%",e=$("<"+(b.tagName||"dud")+' class="dud">').css("width",h).appendTo(a.$);b.class&&e.addClass(b.class);this.attr=b;this.scene=a;var k=null,k=new Image;k.thing=f;k.onload=function(g){b.dims[1]=b.dims[0]*k.height/k.width;f.rwidth=
b.dims[0];f.rheight=b.dims[1];n&&d();f.$.addClass("image "+c);b.static&&(f.$.css("width",h),f.$cnt.replaceWith(f.$),e=f.$);Decor.Object3D.call(f,a,e,b);b.clickable&&(n?l:f.$).click(f.focus);b.static||f.$.appendTo(f.$cnt);if(f.onload)f.onload();a.imageLoaded(c)};k.onerror=a.imageLoaded;k.src=g;f.$=$(k);f.$cnt=e;e[0].thing=this;var l=$(),n=b.clickable&&b.clickable.length,p=b.clickable&&b.clickable.length?b.clickable:[[0,0],[1,1]];b.clickable&&(e.addClass("clickable"),n&&(e.addClass("has-area"),l=$('<div class="click">').css({left:100*
p[0][0]+"%",width:100*(p[1][0]-p[0][0])+"%"}).appendTo(e)));if(n)a.$.on("scene-resize",d);this.destroy=function(){e.remove()}};Decor.Things.Image=function(a,c,b){b.static=!0;Decor.Things.ImageContain.call(this,a,c,b)};Decor.Things.ImageLink=function(a,c,b){b.tagName="a";Decor.Things.ImageContain.call(this,a,c,b);this.$cnt[0].href=b.href;this.$cnt[0].target="_blank";b.title&&(this.$cnt[0].title=b.title)};
Decor.Things.ImageBG=function(a,c,b){Decor.Things.Static.call(this,a,c,b);a.imageLoaded();this.$cnt.css("background-image","url(img/"+b.img+".png)")};Decor.Things.ImageRep=function(a,c,b){a.imageLoaded();for(var d=0;d<b.repeat;d++)a.addLoadImage(),a.objects.push(new Decor.Things.Image(a,c,{img:b.img,width:b.width,pos:[b.pos[0]+d*b.width,b.pos[1],b.pos[2]]}))};
Decor.Things.ThingRep=function(a,c,b){for(var d=0;d<b.repeat;d++)a.objects.push(new Decor.Things.Thing(a,c,{dims:b.dims,px:b.px,pos:[b.pos[0]+d*b.trans[0],b.pos[1]+d*b.trans[1],b.pos[2]-d*b.trans[2]]}))};
Decor.Things.ImageCQuality=function(a,c,b){function d(){k&&g.$cnt[0].removeChild(k);k=null}function f(a){a=this instanceof Image&&this||a;g.$cnt[0].insertBefore(a,k||g.$[0].nextSibling);d();k=a}var g=this;b.quality=b.quality||[b.img.match(/\d*$/)[0]];b.default||(b.default=0);b.mobile&&isMobile&&(b.default=b.mobile);var h=b.img.replace(/\d*$/,"");b.img=h+b.quality[b.default];var e=Array(b.quality.length),k=null;Decor.Things.ImageContain.call(this,a,c,b);this.setQuality=function(a){if(a==b.default||
!b.quality[a])return k&&d();if(e[a])return f(e[a]);e[a]=new Image;e[a].onload=f;e[a].className="image no-events "+c;e[a].src="img/"+h+b.quality[a]+(/\..{3}$/.test(b.img)?"":".png")};if(!b.noMobile||!isMobile)a.$.on("zoom-in",function(a){a.detail==c?(a=b.medium||b.high,b.highTreshX&&b.medium&&(a=innerWidth>b.highTreshX?b.high:b.medium),g.setQuality(a)):d()}).on("zoom-out",d)};
